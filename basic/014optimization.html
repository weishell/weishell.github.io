<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>前端性能优化 | web</title>
    <meta name="generator" content="VuePress 1.9.10">
    <link rel="icon" href="/img/logo.jpg">
    <meta name="description" content="welcome">
    
    <link rel="preload" href="/assets/css/0.styles.0f091984.css" as="style"><link rel="preload" href="/assets/js/app.a6ef9eb3.js" as="script"><link rel="preload" href="/assets/js/2.f1eac84e.js" as="script"><link rel="preload" href="/assets/js/1.51fb246a.js" as="script"><link rel="preload" href="/assets/js/84.a82c0122.js" as="script"><link rel="preload" href="/assets/js/25.8d300037.js" as="script"><link rel="preload" href="/assets/js/24.581980f2.js" as="script"><link rel="prefetch" href="/assets/js/10.91f962c9.js"><link rel="prefetch" href="/assets/js/100.2630a1a8.js"><link rel="prefetch" href="/assets/js/101.238a88c1.js"><link rel="prefetch" href="/assets/js/102.4e16f809.js"><link rel="prefetch" href="/assets/js/103.5bdd2be3.js"><link rel="prefetch" href="/assets/js/104.aaa355de.js"><link rel="prefetch" href="/assets/js/105.e5ebbf6f.js"><link rel="prefetch" href="/assets/js/106.33c12f82.js"><link rel="prefetch" href="/assets/js/107.1ee9c675.js"><link rel="prefetch" href="/assets/js/108.b756b752.js"><link rel="prefetch" href="/assets/js/109.c4225451.js"><link rel="prefetch" href="/assets/js/11.1e3ddc53.js"><link rel="prefetch" href="/assets/js/110.de1f4e0a.js"><link rel="prefetch" href="/assets/js/111.c0f0ed20.js"><link rel="prefetch" href="/assets/js/112.143d525d.js"><link rel="prefetch" href="/assets/js/113.e3bc9f63.js"><link rel="prefetch" href="/assets/js/114.01ed8587.js"><link rel="prefetch" href="/assets/js/115.41c23861.js"><link rel="prefetch" href="/assets/js/116.d64f7cd4.js"><link rel="prefetch" href="/assets/js/117.ad4fff58.js"><link rel="prefetch" href="/assets/js/118.d8f531f9.js"><link rel="prefetch" href="/assets/js/119.01ca6c4f.js"><link rel="prefetch" href="/assets/js/12.e844f844.js"><link rel="prefetch" href="/assets/js/120.bc952b19.js"><link rel="prefetch" href="/assets/js/121.34167d9d.js"><link rel="prefetch" href="/assets/js/122.0c0f97a5.js"><link rel="prefetch" href="/assets/js/123.41b3a32c.js"><link rel="prefetch" href="/assets/js/124.b7ac31d2.js"><link rel="prefetch" href="/assets/js/125.60e79cdc.js"><link rel="prefetch" href="/assets/js/126.9a89bdb8.js"><link rel="prefetch" href="/assets/js/127.4023efbe.js"><link rel="prefetch" href="/assets/js/128.63061f40.js"><link rel="prefetch" href="/assets/js/129.bb72e920.js"><link rel="prefetch" href="/assets/js/13.43971db2.js"><link rel="prefetch" href="/assets/js/130.66192d84.js"><link rel="prefetch" href="/assets/js/131.1fda7165.js"><link rel="prefetch" href="/assets/js/132.a332e0a5.js"><link rel="prefetch" href="/assets/js/133.990844fd.js"><link rel="prefetch" href="/assets/js/134.3006c0e7.js"><link rel="prefetch" href="/assets/js/135.7659161c.js"><link rel="prefetch" href="/assets/js/136.f6236249.js"><link rel="prefetch" href="/assets/js/137.90b8718e.js"><link rel="prefetch" href="/assets/js/138.44bd743d.js"><link rel="prefetch" href="/assets/js/139.c6002821.js"><link rel="prefetch" href="/assets/js/14.5fc851b9.js"><link rel="prefetch" href="/assets/js/140.e2737049.js"><link rel="prefetch" href="/assets/js/141.3c16e849.js"><link rel="prefetch" href="/assets/js/142.46ed3dc1.js"><link rel="prefetch" href="/assets/js/143.9dab3b69.js"><link rel="prefetch" href="/assets/js/144.21fde52a.js"><link rel="prefetch" href="/assets/js/145.1c214fe4.js"><link rel="prefetch" href="/assets/js/146.e37e78f0.js"><link rel="prefetch" href="/assets/js/147.e3d42664.js"><link rel="prefetch" href="/assets/js/148.4c4961cd.js"><link rel="prefetch" href="/assets/js/149.2147121b.js"><link rel="prefetch" href="/assets/js/15.42ceb2eb.js"><link rel="prefetch" href="/assets/js/150.807717b9.js"><link rel="prefetch" href="/assets/js/151.3d52ba85.js"><link rel="prefetch" href="/assets/js/152.e6037011.js"><link rel="prefetch" href="/assets/js/153.cd82f3e5.js"><link rel="prefetch" href="/assets/js/154.93deabe8.js"><link rel="prefetch" href="/assets/js/155.bc2d45c5.js"><link rel="prefetch" href="/assets/js/156.ba58f0f4.js"><link rel="prefetch" href="/assets/js/157.d106dc58.js"><link rel="prefetch" href="/assets/js/158.dd7ab998.js"><link rel="prefetch" href="/assets/js/159.646e9997.js"><link rel="prefetch" href="/assets/js/16.fa4a9a28.js"><link rel="prefetch" href="/assets/js/160.beb94709.js"><link rel="prefetch" href="/assets/js/161.b4ea5f77.js"><link rel="prefetch" href="/assets/js/162.10ceca64.js"><link rel="prefetch" href="/assets/js/163.1cacd4fc.js"><link rel="prefetch" href="/assets/js/164.cc24c028.js"><link rel="prefetch" href="/assets/js/165.2c89b18f.js"><link rel="prefetch" href="/assets/js/166.218a003d.js"><link rel="prefetch" href="/assets/js/167.08587f20.js"><link rel="prefetch" href="/assets/js/168.153c9f56.js"><link rel="prefetch" href="/assets/js/169.33392c80.js"><link rel="prefetch" href="/assets/js/17.bbbe20c1.js"><link rel="prefetch" href="/assets/js/170.5473e334.js"><link rel="prefetch" href="/assets/js/171.c6670226.js"><link rel="prefetch" href="/assets/js/172.2847c244.js"><link rel="prefetch" href="/assets/js/173.cf5a69c2.js"><link rel="prefetch" href="/assets/js/174.8b383e67.js"><link rel="prefetch" href="/assets/js/175.f18a8823.js"><link rel="prefetch" href="/assets/js/176.525a5624.js"><link rel="prefetch" href="/assets/js/177.c2778edf.js"><link rel="prefetch" href="/assets/js/178.a5dc9e05.js"><link rel="prefetch" href="/assets/js/179.cecb46ba.js"><link rel="prefetch" href="/assets/js/18.7effc85f.js"><link rel="prefetch" href="/assets/js/180.322a8bd6.js"><link rel="prefetch" href="/assets/js/181.2cf00de0.js"><link rel="prefetch" href="/assets/js/182.e6d1b681.js"><link rel="prefetch" href="/assets/js/183.4b23c724.js"><link rel="prefetch" href="/assets/js/184.4181fe79.js"><link rel="prefetch" href="/assets/js/185.db268c11.js"><link rel="prefetch" href="/assets/js/186.050b4f1c.js"><link rel="prefetch" href="/assets/js/187.e5b545cc.js"><link rel="prefetch" href="/assets/js/188.fa28f55a.js"><link rel="prefetch" href="/assets/js/189.f1b63474.js"><link rel="prefetch" href="/assets/js/19.de4a5cca.js"><link rel="prefetch" href="/assets/js/190.349ec936.js"><link rel="prefetch" href="/assets/js/191.25f36725.js"><link rel="prefetch" href="/assets/js/192.2f60e864.js"><link rel="prefetch" href="/assets/js/193.01b7b759.js"><link rel="prefetch" href="/assets/js/194.8f086961.js"><link rel="prefetch" href="/assets/js/195.46309cdd.js"><link rel="prefetch" href="/assets/js/196.eba14cb5.js"><link rel="prefetch" href="/assets/js/197.121c467f.js"><link rel="prefetch" href="/assets/js/198.b1f89d18.js"><link rel="prefetch" href="/assets/js/199.16ddec20.js"><link rel="prefetch" href="/assets/js/20.ba2395ea.js"><link rel="prefetch" href="/assets/js/200.25d1faff.js"><link rel="prefetch" href="/assets/js/201.da17a820.js"><link rel="prefetch" href="/assets/js/202.69c6acd2.js"><link rel="prefetch" href="/assets/js/203.ec53dc27.js"><link rel="prefetch" href="/assets/js/204.1cce86b7.js"><link rel="prefetch" href="/assets/js/205.01f1a034.js"><link rel="prefetch" href="/assets/js/206.b8dcd61d.js"><link rel="prefetch" href="/assets/js/207.0a815930.js"><link rel="prefetch" href="/assets/js/208.99e84f59.js"><link rel="prefetch" href="/assets/js/209.b5d4f70b.js"><link rel="prefetch" href="/assets/js/21.d58e0c8b.js"><link rel="prefetch" href="/assets/js/210.41b81905.js"><link rel="prefetch" href="/assets/js/211.cbb3b2ed.js"><link rel="prefetch" href="/assets/js/212.09f1bf91.js"><link rel="prefetch" href="/assets/js/213.8891dca9.js"><link rel="prefetch" href="/assets/js/214.78a320cf.js"><link rel="prefetch" href="/assets/js/215.9aa7e8b9.js"><link rel="prefetch" href="/assets/js/216.97fa0d10.js"><link rel="prefetch" href="/assets/js/217.8fefd47e.js"><link rel="prefetch" href="/assets/js/218.6c1a6e6f.js"><link rel="prefetch" href="/assets/js/219.efcf739b.js"><link rel="prefetch" href="/assets/js/22.6efb638c.js"><link rel="prefetch" href="/assets/js/220.8faf1f88.js"><link rel="prefetch" href="/assets/js/221.bd2700c4.js"><link rel="prefetch" href="/assets/js/222.d4fde4ef.js"><link rel="prefetch" href="/assets/js/223.155571f5.js"><link rel="prefetch" href="/assets/js/224.e622589e.js"><link rel="prefetch" href="/assets/js/225.9fdb8f1c.js"><link rel="prefetch" href="/assets/js/226.6be9fba5.js"><link rel="prefetch" href="/assets/js/227.a1ce038f.js"><link rel="prefetch" href="/assets/js/228.cd7ec4f8.js"><link rel="prefetch" href="/assets/js/229.10a0dfa3.js"><link rel="prefetch" href="/assets/js/23.136d09c5.js"><link rel="prefetch" href="/assets/js/230.1d8309db.js"><link rel="prefetch" href="/assets/js/231.08811a40.js"><link rel="prefetch" href="/assets/js/232.5c4e040d.js"><link rel="prefetch" href="/assets/js/233.d74693c9.js"><link rel="prefetch" href="/assets/js/234.a1ee3d15.js"><link rel="prefetch" href="/assets/js/235.bc9c7cde.js"><link rel="prefetch" href="/assets/js/236.0008cd42.js"><link rel="prefetch" href="/assets/js/237.0caa1088.js"><link rel="prefetch" href="/assets/js/238.bf3ee95d.js"><link rel="prefetch" href="/assets/js/239.c2d8d7c7.js"><link rel="prefetch" href="/assets/js/240.c4ccc749.js"><link rel="prefetch" href="/assets/js/241.8545d363.js"><link rel="prefetch" href="/assets/js/242.1bb42f24.js"><link rel="prefetch" href="/assets/js/243.0a878fb9.js"><link rel="prefetch" href="/assets/js/244.cffbc13f.js"><link rel="prefetch" href="/assets/js/245.549a2417.js"><link rel="prefetch" href="/assets/js/246.f53e4059.js"><link rel="prefetch" href="/assets/js/247.51b87a81.js"><link rel="prefetch" href="/assets/js/248.a0c31565.js"><link rel="prefetch" href="/assets/js/249.88a513e0.js"><link rel="prefetch" href="/assets/js/250.0c4447cc.js"><link rel="prefetch" href="/assets/js/251.47696940.js"><link rel="prefetch" href="/assets/js/252.99039099.js"><link rel="prefetch" href="/assets/js/253.cfec13d7.js"><link rel="prefetch" href="/assets/js/254.b29d69c8.js"><link rel="prefetch" href="/assets/js/255.76a941e1.js"><link rel="prefetch" href="/assets/js/256.7a754c14.js"><link rel="prefetch" href="/assets/js/257.55f0796f.js"><link rel="prefetch" href="/assets/js/258.d8ea4a45.js"><link rel="prefetch" href="/assets/js/259.421b2971.js"><link rel="prefetch" href="/assets/js/26.055a3567.js"><link rel="prefetch" href="/assets/js/260.1c706e0d.js"><link rel="prefetch" href="/assets/js/261.dfca34b2.js"><link rel="prefetch" href="/assets/js/262.a203b1b6.js"><link rel="prefetch" href="/assets/js/263.a42b4a13.js"><link rel="prefetch" href="/assets/js/264.1be40b18.js"><link rel="prefetch" href="/assets/js/265.5d1959af.js"><link rel="prefetch" href="/assets/js/266.39d17e7f.js"><link rel="prefetch" href="/assets/js/267.4716aff7.js"><link rel="prefetch" href="/assets/js/268.fc9267a5.js"><link rel="prefetch" href="/assets/js/269.37cb9b88.js"><link rel="prefetch" href="/assets/js/27.a8a1c6dc.js"><link rel="prefetch" href="/assets/js/270.f13990c7.js"><link rel="prefetch" href="/assets/js/271.4c0e1f59.js"><link rel="prefetch" href="/assets/js/272.4295fefc.js"><link rel="prefetch" href="/assets/js/273.c8fdedf4.js"><link rel="prefetch" href="/assets/js/274.1d0cb557.js"><link rel="prefetch" href="/assets/js/275.93ae8d8a.js"><link rel="prefetch" href="/assets/js/276.d213abf2.js"><link rel="prefetch" href="/assets/js/277.d7999c1f.js"><link rel="prefetch" href="/assets/js/278.56e59ff9.js"><link rel="prefetch" href="/assets/js/279.f907e3f5.js"><link rel="prefetch" href="/assets/js/28.cc29fd28.js"><link rel="prefetch" href="/assets/js/280.49d3005e.js"><link rel="prefetch" href="/assets/js/281.adc179a9.js"><link rel="prefetch" href="/assets/js/282.ddf4eb33.js"><link rel="prefetch" href="/assets/js/283.4c6d0377.js"><link rel="prefetch" href="/assets/js/284.52c8d3d9.js"><link rel="prefetch" href="/assets/js/285.cdd66f15.js"><link rel="prefetch" href="/assets/js/286.280bc0c8.js"><link rel="prefetch" href="/assets/js/287.900e679a.js"><link rel="prefetch" href="/assets/js/288.7499b06a.js"><link rel="prefetch" href="/assets/js/289.4824183e.js"><link rel="prefetch" href="/assets/js/29.5b7c6405.js"><link rel="prefetch" href="/assets/js/290.e02bad76.js"><link rel="prefetch" href="/assets/js/291.181ccac3.js"><link rel="prefetch" href="/assets/js/292.6c14e58d.js"><link rel="prefetch" href="/assets/js/293.99d562ef.js"><link rel="prefetch" href="/assets/js/294.4272d207.js"><link rel="prefetch" href="/assets/js/295.678928d4.js"><link rel="prefetch" href="/assets/js/296.d0a1bbbf.js"><link rel="prefetch" href="/assets/js/297.e2d50d12.js"><link rel="prefetch" href="/assets/js/298.76779bbf.js"><link rel="prefetch" href="/assets/js/299.471a9139.js"><link rel="prefetch" href="/assets/js/3.dcf84505.js"><link rel="prefetch" href="/assets/js/30.d0408706.js"><link rel="prefetch" href="/assets/js/300.8fea8394.js"><link rel="prefetch" href="/assets/js/301.07cb6dc0.js"><link rel="prefetch" href="/assets/js/302.714c5325.js"><link rel="prefetch" href="/assets/js/303.10377da3.js"><link rel="prefetch" href="/assets/js/304.4bdfb7ff.js"><link rel="prefetch" href="/assets/js/305.739db575.js"><link rel="prefetch" href="/assets/js/306.fdfe8425.js"><link rel="prefetch" href="/assets/js/307.f5a95630.js"><link rel="prefetch" href="/assets/js/308.4a77728c.js"><link rel="prefetch" href="/assets/js/309.f5554c6f.js"><link rel="prefetch" href="/assets/js/31.4482053d.js"><link rel="prefetch" href="/assets/js/310.5c328053.js"><link rel="prefetch" href="/assets/js/311.543cad4f.js"><link rel="prefetch" href="/assets/js/312.6a97e356.js"><link rel="prefetch" href="/assets/js/313.60ddb677.js"><link rel="prefetch" href="/assets/js/314.a3672853.js"><link rel="prefetch" href="/assets/js/315.b82e3ac7.js"><link rel="prefetch" href="/assets/js/316.83bdb0a4.js"><link rel="prefetch" href="/assets/js/317.09045a45.js"><link rel="prefetch" href="/assets/js/318.5cf60aee.js"><link rel="prefetch" href="/assets/js/319.4e401c96.js"><link rel="prefetch" href="/assets/js/32.a6bc6477.js"><link rel="prefetch" href="/assets/js/320.3f325470.js"><link rel="prefetch" href="/assets/js/321.b276d318.js"><link rel="prefetch" href="/assets/js/322.30c625ab.js"><link rel="prefetch" href="/assets/js/323.47db3720.js"><link rel="prefetch" href="/assets/js/324.d990271b.js"><link rel="prefetch" href="/assets/js/325.28614e00.js"><link rel="prefetch" href="/assets/js/326.767571aa.js"><link rel="prefetch" href="/assets/js/327.3d9cda33.js"><link rel="prefetch" href="/assets/js/328.d1183336.js"><link rel="prefetch" href="/assets/js/329.209c82c7.js"><link rel="prefetch" href="/assets/js/33.75360b0a.js"><link rel="prefetch" href="/assets/js/330.e5ec43b0.js"><link rel="prefetch" href="/assets/js/331.409ce80e.js"><link rel="prefetch" href="/assets/js/332.184cb96d.js"><link rel="prefetch" href="/assets/js/333.04f1c11d.js"><link rel="prefetch" href="/assets/js/334.e1b11f6c.js"><link rel="prefetch" href="/assets/js/335.b77890c8.js"><link rel="prefetch" href="/assets/js/336.6a386da9.js"><link rel="prefetch" href="/assets/js/337.20501bd7.js"><link rel="prefetch" href="/assets/js/338.e240e027.js"><link rel="prefetch" href="/assets/js/339.8f41054d.js"><link rel="prefetch" href="/assets/js/34.b4003afa.js"><link rel="prefetch" href="/assets/js/340.315d1cfa.js"><link rel="prefetch" href="/assets/js/341.706a837b.js"><link rel="prefetch" href="/assets/js/342.6edb896b.js"><link rel="prefetch" href="/assets/js/343.a3555f02.js"><link rel="prefetch" href="/assets/js/344.279db7ad.js"><link rel="prefetch" href="/assets/js/345.da9af889.js"><link rel="prefetch" href="/assets/js/346.96ac3964.js"><link rel="prefetch" href="/assets/js/347.12b0354f.js"><link rel="prefetch" href="/assets/js/348.a439683b.js"><link rel="prefetch" href="/assets/js/349.ee4452f2.js"><link rel="prefetch" href="/assets/js/35.f9cc7e10.js"><link rel="prefetch" href="/assets/js/350.945742ff.js"><link rel="prefetch" href="/assets/js/351.f2609e46.js"><link rel="prefetch" href="/assets/js/352.a0329e34.js"><link rel="prefetch" href="/assets/js/353.53246858.js"><link rel="prefetch" href="/assets/js/354.5d5823a3.js"><link rel="prefetch" href="/assets/js/355.5c77f043.js"><link rel="prefetch" href="/assets/js/356.daf19818.js"><link rel="prefetch" href="/assets/js/357.e1f5fca8.js"><link rel="prefetch" href="/assets/js/358.4b41e482.js"><link rel="prefetch" href="/assets/js/359.6b76f84d.js"><link rel="prefetch" href="/assets/js/36.6f3dbb4d.js"><link rel="prefetch" href="/assets/js/360.45fa5579.js"><link rel="prefetch" href="/assets/js/361.cc44c09a.js"><link rel="prefetch" href="/assets/js/362.dd18fbb8.js"><link rel="prefetch" href="/assets/js/363.7dacec11.js"><link rel="prefetch" href="/assets/js/364.d6c688ae.js"><link rel="prefetch" href="/assets/js/365.2fc84610.js"><link rel="prefetch" href="/assets/js/366.b9e58b96.js"><link rel="prefetch" href="/assets/js/367.dd072641.js"><link rel="prefetch" href="/assets/js/368.0438da78.js"><link rel="prefetch" href="/assets/js/369.543e06c9.js"><link rel="prefetch" href="/assets/js/37.2e07e271.js"><link rel="prefetch" href="/assets/js/370.921ea4a6.js"><link rel="prefetch" href="/assets/js/371.9de92310.js"><link rel="prefetch" href="/assets/js/372.f2a2aec9.js"><link rel="prefetch" href="/assets/js/373.24975987.js"><link rel="prefetch" href="/assets/js/374.5ae16c4a.js"><link rel="prefetch" href="/assets/js/375.8e1c99a3.js"><link rel="prefetch" href="/assets/js/376.c79b376d.js"><link rel="prefetch" href="/assets/js/377.6bc89556.js"><link rel="prefetch" href="/assets/js/378.59c5d8cc.js"><link rel="prefetch" href="/assets/js/379.43314043.js"><link rel="prefetch" href="/assets/js/38.344a1f74.js"><link rel="prefetch" href="/assets/js/380.e2a9727a.js"><link rel="prefetch" href="/assets/js/381.58509528.js"><link rel="prefetch" href="/assets/js/382.f4bc158f.js"><link rel="prefetch" href="/assets/js/383.52aa4761.js"><link rel="prefetch" href="/assets/js/384.209ab81c.js"><link rel="prefetch" href="/assets/js/385.970f742b.js"><link rel="prefetch" href="/assets/js/386.7e6b6f76.js"><link rel="prefetch" href="/assets/js/387.566a117f.js"><link rel="prefetch" href="/assets/js/388.f5acf871.js"><link rel="prefetch" href="/assets/js/389.3a976d73.js"><link rel="prefetch" href="/assets/js/39.a9095fe8.js"><link rel="prefetch" href="/assets/js/390.7c999a6d.js"><link rel="prefetch" href="/assets/js/391.4c619ba8.js"><link rel="prefetch" href="/assets/js/392.81089e48.js"><link rel="prefetch" href="/assets/js/393.0ccae363.js"><link rel="prefetch" href="/assets/js/394.1735c4da.js"><link rel="prefetch" href="/assets/js/395.d84a5d38.js"><link rel="prefetch" href="/assets/js/396.5f87ddfb.js"><link rel="prefetch" href="/assets/js/397.a451400c.js"><link rel="prefetch" href="/assets/js/398.2824bb2f.js"><link rel="prefetch" href="/assets/js/399.53e655ab.js"><link rel="prefetch" href="/assets/js/4.84c7e22e.js"><link rel="prefetch" href="/assets/js/40.ff6c5ea3.js"><link rel="prefetch" href="/assets/js/400.72284c59.js"><link rel="prefetch" href="/assets/js/401.f035b2e8.js"><link rel="prefetch" href="/assets/js/402.2e36b409.js"><link rel="prefetch" href="/assets/js/403.28061781.js"><link rel="prefetch" href="/assets/js/404.25d19b4d.js"><link rel="prefetch" href="/assets/js/405.341c1a01.js"><link rel="prefetch" href="/assets/js/406.1cc9b446.js"><link rel="prefetch" href="/assets/js/407.811860fd.js"><link rel="prefetch" href="/assets/js/408.c8887e5a.js"><link rel="prefetch" href="/assets/js/409.8ed387ed.js"><link rel="prefetch" href="/assets/js/41.47bec4ee.js"><link rel="prefetch" href="/assets/js/410.b65c4432.js"><link rel="prefetch" href="/assets/js/411.aa04b4d5.js"><link rel="prefetch" href="/assets/js/412.65f3abef.js"><link rel="prefetch" href="/assets/js/413.2c5e4cf6.js"><link rel="prefetch" href="/assets/js/414.b554ad00.js"><link rel="prefetch" href="/assets/js/415.52b5e505.js"><link rel="prefetch" href="/assets/js/416.c6ee6a56.js"><link rel="prefetch" href="/assets/js/417.8d3aead6.js"><link rel="prefetch" href="/assets/js/418.1f5c6402.js"><link rel="prefetch" href="/assets/js/419.fc5349e5.js"><link rel="prefetch" href="/assets/js/42.63e0ee0c.js"><link rel="prefetch" href="/assets/js/420.48d58b2e.js"><link rel="prefetch" href="/assets/js/421.095abaae.js"><link rel="prefetch" href="/assets/js/422.ff849f70.js"><link rel="prefetch" href="/assets/js/423.3334ef24.js"><link rel="prefetch" href="/assets/js/424.83b76f32.js"><link rel="prefetch" href="/assets/js/425.805f78c9.js"><link rel="prefetch" href="/assets/js/426.7c1c0bc7.js"><link rel="prefetch" href="/assets/js/427.f7a20bb0.js"><link rel="prefetch" href="/assets/js/428.ffd1b336.js"><link rel="prefetch" href="/assets/js/429.fa027072.js"><link rel="prefetch" href="/assets/js/43.99bcbaea.js"><link rel="prefetch" href="/assets/js/430.4bf4f8f2.js"><link rel="prefetch" href="/assets/js/431.43715af5.js"><link rel="prefetch" href="/assets/js/432.7cecb0c4.js"><link rel="prefetch" href="/assets/js/433.7cd2e477.js"><link rel="prefetch" href="/assets/js/434.5c43ce2e.js"><link rel="prefetch" href="/assets/js/435.0fe5f9dc.js"><link rel="prefetch" href="/assets/js/436.700be4be.js"><link rel="prefetch" href="/assets/js/437.d8fa0865.js"><link rel="prefetch" href="/assets/js/438.b0488a8d.js"><link rel="prefetch" href="/assets/js/439.2924f602.js"><link rel="prefetch" href="/assets/js/44.c846b4a3.js"><link rel="prefetch" href="/assets/js/440.ccab05eb.js"><link rel="prefetch" href="/assets/js/441.e2343552.js"><link rel="prefetch" href="/assets/js/442.1ed14c73.js"><link rel="prefetch" href="/assets/js/443.4b58f65e.js"><link rel="prefetch" href="/assets/js/444.59bf0c23.js"><link rel="prefetch" href="/assets/js/445.bfad0005.js"><link rel="prefetch" href="/assets/js/446.d009675b.js"><link rel="prefetch" href="/assets/js/447.32a85985.js"><link rel="prefetch" href="/assets/js/448.8e4e3bb4.js"><link rel="prefetch" href="/assets/js/449.95fdecbd.js"><link rel="prefetch" href="/assets/js/45.b354c95c.js"><link rel="prefetch" href="/assets/js/450.50820776.js"><link rel="prefetch" href="/assets/js/451.8c6470f1.js"><link rel="prefetch" href="/assets/js/452.c3f4ce27.js"><link rel="prefetch" href="/assets/js/453.88c0b593.js"><link rel="prefetch" href="/assets/js/454.97df2ad9.js"><link rel="prefetch" href="/assets/js/455.929dfeea.js"><link rel="prefetch" href="/assets/js/456.64cc9992.js"><link rel="prefetch" href="/assets/js/457.3931a9cd.js"><link rel="prefetch" href="/assets/js/458.a78e009f.js"><link rel="prefetch" href="/assets/js/459.c3e33d76.js"><link rel="prefetch" href="/assets/js/46.c1a98c24.js"><link rel="prefetch" href="/assets/js/460.7ca186ae.js"><link rel="prefetch" href="/assets/js/461.f2b33897.js"><link rel="prefetch" href="/assets/js/462.4943b7c7.js"><link rel="prefetch" href="/assets/js/463.bc37f3e5.js"><link rel="prefetch" href="/assets/js/464.f0fab90f.js"><link rel="prefetch" href="/assets/js/465.a395dae6.js"><link rel="prefetch" href="/assets/js/466.32871a41.js"><link rel="prefetch" href="/assets/js/467.495b208f.js"><link rel="prefetch" href="/assets/js/468.db8e45cc.js"><link rel="prefetch" href="/assets/js/469.70ebbf64.js"><link rel="prefetch" href="/assets/js/47.72f49fec.js"><link rel="prefetch" href="/assets/js/470.2bf3d400.js"><link rel="prefetch" href="/assets/js/471.b5fdd21f.js"><link rel="prefetch" href="/assets/js/472.ee4f238a.js"><link rel="prefetch" href="/assets/js/473.78ca22b6.js"><link rel="prefetch" href="/assets/js/474.edf07798.js"><link rel="prefetch" href="/assets/js/475.be62ee04.js"><link rel="prefetch" href="/assets/js/476.b1460dd7.js"><link rel="prefetch" href="/assets/js/477.bb36b51b.js"><link rel="prefetch" href="/assets/js/478.52da17d3.js"><link rel="prefetch" href="/assets/js/479.4c9c7af3.js"><link rel="prefetch" href="/assets/js/48.97b15f27.js"><link rel="prefetch" href="/assets/js/480.2cb47e38.js"><link rel="prefetch" href="/assets/js/481.c2a4b742.js"><link rel="prefetch" href="/assets/js/482.e7347490.js"><link rel="prefetch" href="/assets/js/483.1b7447ac.js"><link rel="prefetch" href="/assets/js/484.e1f73e17.js"><link rel="prefetch" href="/assets/js/485.1be4e8bf.js"><link rel="prefetch" href="/assets/js/486.93988520.js"><link rel="prefetch" href="/assets/js/487.9457ab90.js"><link rel="prefetch" href="/assets/js/488.57c80c97.js"><link rel="prefetch" href="/assets/js/489.5fd4e916.js"><link rel="prefetch" href="/assets/js/49.2d947248.js"><link rel="prefetch" href="/assets/js/490.f8bb4ef2.js"><link rel="prefetch" href="/assets/js/491.3459e4d8.js"><link rel="prefetch" href="/assets/js/492.6d4b1e37.js"><link rel="prefetch" href="/assets/js/493.fd1984e4.js"><link rel="prefetch" href="/assets/js/494.dbf5783f.js"><link rel="prefetch" href="/assets/js/495.4993f9ed.js"><link rel="prefetch" href="/assets/js/496.2f640f77.js"><link rel="prefetch" href="/assets/js/497.81f2e88f.js"><link rel="prefetch" href="/assets/js/498.a7f5abca.js"><link rel="prefetch" href="/assets/js/499.198b6ec8.js"><link rel="prefetch" href="/assets/js/5.92e410ee.js"><link rel="prefetch" href="/assets/js/50.72bf2eab.js"><link rel="prefetch" href="/assets/js/500.c456c512.js"><link rel="prefetch" href="/assets/js/501.006b16a3.js"><link rel="prefetch" href="/assets/js/51.3a3dee7c.js"><link rel="prefetch" href="/assets/js/52.ebc8c175.js"><link rel="prefetch" href="/assets/js/53.743b403f.js"><link rel="prefetch" href="/assets/js/54.4ad6926e.js"><link rel="prefetch" href="/assets/js/55.5829f86d.js"><link rel="prefetch" href="/assets/js/56.ace2d319.js"><link rel="prefetch" href="/assets/js/57.6e59ac52.js"><link rel="prefetch" href="/assets/js/58.6137db52.js"><link rel="prefetch" href="/assets/js/59.e41af536.js"><link rel="prefetch" href="/assets/js/6.27ad90f1.js"><link rel="prefetch" href="/assets/js/60.49830cd6.js"><link rel="prefetch" href="/assets/js/61.f9c72baa.js"><link rel="prefetch" href="/assets/js/62.66609025.js"><link rel="prefetch" href="/assets/js/63.41d03544.js"><link rel="prefetch" href="/assets/js/64.9d483265.js"><link rel="prefetch" href="/assets/js/65.55490643.js"><link rel="prefetch" href="/assets/js/66.2c0014ca.js"><link rel="prefetch" href="/assets/js/67.9d9a292b.js"><link rel="prefetch" href="/assets/js/68.384c644b.js"><link rel="prefetch" href="/assets/js/69.29278715.js"><link rel="prefetch" href="/assets/js/7.25563a7a.js"><link rel="prefetch" href="/assets/js/70.0554dfa0.js"><link rel="prefetch" href="/assets/js/71.7ccb8751.js"><link rel="prefetch" href="/assets/js/72.3ac44f00.js"><link rel="prefetch" href="/assets/js/73.a7cd51c5.js"><link rel="prefetch" href="/assets/js/74.74b142d5.js"><link rel="prefetch" href="/assets/js/75.64656b7b.js"><link rel="prefetch" href="/assets/js/76.46da0799.js"><link rel="prefetch" href="/assets/js/77.f7555b12.js"><link rel="prefetch" href="/assets/js/78.5d3fa8db.js"><link rel="prefetch" href="/assets/js/79.d6526e55.js"><link rel="prefetch" href="/assets/js/80.4ac6fa1a.js"><link rel="prefetch" href="/assets/js/81.5e53dfff.js"><link rel="prefetch" href="/assets/js/82.a198e182.js"><link rel="prefetch" href="/assets/js/83.1bd6e4d5.js"><link rel="prefetch" href="/assets/js/85.50119e3c.js"><link rel="prefetch" href="/assets/js/86.2b059d2d.js"><link rel="prefetch" href="/assets/js/87.ed93a6e2.js"><link rel="prefetch" href="/assets/js/88.baccac3d.js"><link rel="prefetch" href="/assets/js/89.6082dd39.js"><link rel="prefetch" href="/assets/js/90.fe7b52c8.js"><link rel="prefetch" href="/assets/js/91.3c9efe07.js"><link rel="prefetch" href="/assets/js/92.e15a7fee.js"><link rel="prefetch" href="/assets/js/93.d49bb344.js"><link rel="prefetch" href="/assets/js/94.e07d26c6.js"><link rel="prefetch" href="/assets/js/95.d1ab4789.js"><link rel="prefetch" href="/assets/js/96.e0c5c7cb.js"><link rel="prefetch" href="/assets/js/97.240e970d.js"><link rel="prefetch" href="/assets/js/98.89f73097.js"><link rel="prefetch" href="/assets/js/99.23094e65.js"><link rel="prefetch" href="/assets/js/vendors~docsearch.5ecec0e5.js">
    <link rel="stylesheet" href="/assets/css/0.styles.0f091984.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">web</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端" class="dropdown-title"><span class="title">前端</span> <span class="arrow down"></span></button> <button type="button" aria-label="前端" class="mobile-dropdown-title"><span class="title">前端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/ajax/" class="nav-link">
  ajax
</a></li><li class="dropdown-item"><!----> <a href="/angular/" class="nav-link">
  angular
</a></li><li class="dropdown-item"><!----> <a href="/3d/" class="nav-link">
  3d
</a></li><li class="dropdown-item"><!----> <a href="/basic/" class="nav-link router-link-active">
  basic
</a></li><li class="dropdown-item"><!----> <a href="/canvas/" class="nav-link">
  canvas
</a></li><li class="dropdown-item"><!----> <a href="/chart/" class="nav-link">
  chart
</a></li><li class="dropdown-item"><!----> <a href="/css/" class="nav-link">
  css
</a></li><li class="dropdown-item"><!----> <a href="/d3/" class="nav-link">
  d3
</a></li><li class="dropdown-item"><!----> <a href="/es6/" class="nav-link">
  es6
</a></li><li class="dropdown-item"><!----> <a href="/fast/" class="nav-link">
  fast
</a></li><li class="dropdown-item"><!----> <a href="/htmlcss/" class="nav-link">
  htmlcss
</a></li><li class="dropdown-item"><!----> <a href="/jsstore/" class="nav-link">
  jsstore
</a></li><li class="dropdown-item"><!----> <a href="/object/" class="nav-link">
  object
</a></li><li class="dropdown-item"><!----> <a href="/plugin/" class="nav-link">
  plugin
</a></li><li class="dropdown-item"><!----> <a href="/react/" class="nav-link">
  react
</a></li><li class="dropdown-item"><!----> <a href="/svg/" class="nav-link">
  svg
</a></li><li class="dropdown-item"><!----> <a href="/ssr/" class="nav-link">
  ssr
</a></li><li class="dropdown-item"><!----> <a href="/test/" class="nav-link">
  test
</a></li><li class="dropdown-item"><!----> <a href="/typescript/" class="nav-link">
  Typescript
</a></li><li class="dropdown-item"><!----> <a href="/ui/" class="nav-link">
  ui
</a></li><li class="dropdown-item"><!----> <a href="/vue/" class="nav-link">
  vue
</a></li><li class="dropdown-item"><!----> <a href="/webdb/" class="nav-link">
  webdb
</a></li><li class="dropdown-item"><!----> <a href="/webpack/" class="nav-link">
  webpack
</a></li><li class="dropdown-item"><!----> <a href="/webrtc/" class="nav-link">
  webrtc
</a></li><li class="dropdown-item"><!----> <a href="/wx/" class="nav-link">
  wx
</a></li><li class="dropdown-item"><!----> <a href="/phone/" class="nav-link">
  phone
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="后端" class="dropdown-title"><span class="title">后端</span> <span class="arrow down"></span></button> <button type="button" aria-label="后端" class="mobile-dropdown-title"><span class="title">后端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/node/" class="nav-link">
  node
</a></li><li class="dropdown-item"><!----> <a href="/koa/" class="nav-link">
  koa
</a></li><li class="dropdown-item"><!----> <a href="/mongo/" class="nav-link">
  mongo
</a></li><li class="dropdown-item"><!----> <a href="/mysql/" class="nav-link">
  mysql
</a></li><li class="dropdown-item"><!----> <a href="/http/" class="nav-link">
  http
</a></li><li class="dropdown-item"><!----> <a href="/nginx/" class="nav-link">
  nginx
</a></li><li class="dropdown-item"><!----> <a href="/other/" class="nav-link">
  other
</a></li><li class="dropdown-item"><!----> <a href="/python/" class="nav-link">
  python
</a></li><li class="dropdown-item"><!----> <a href="/mk/" class="nav-link">
  mk
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="其他" class="dropdown-title"><span class="title">其他</span> <span class="arrow down"></span></button> <button type="button" aria-label="其他" class="mobile-dropdown-title"><span class="title">其他</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/reactnative/" class="nav-link">
  reactnative
</a></li><li class="dropdown-item"><!----> <a href="/s100/" class="nav-link">
  question
</a></li><li class="dropdown-item"><!----> <a href="/hmos/" class="nav-link">
  hmos
</a></li><li class="dropdown-item"><!----> <a href="/book/" class="nav-link">
  book
</a></li><li class="dropdown-item"><!----> <a href="/confusing/" class="nav-link">
  confusing
</a></li><li class="dropdown-item"><!----> <a href="/tool/" class="nav-link">
  tool
</a></li><li class="dropdown-item"><!----> <a href="/increase/" class="nav-link">
  increase
</a></li><li class="dropdown-item"><!----> <a href="/write/" class="nav-link">
  write
</a></li><li class="dropdown-item"><!----> <a href="/interview/" class="nav-link">
  interview
</a></li><li class="dropdown-item"><!----> <a href="https://github.com/weishell/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://gitee.com/weishell/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  gitee
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端" class="dropdown-title"><span class="title">前端</span> <span class="arrow down"></span></button> <button type="button" aria-label="前端" class="mobile-dropdown-title"><span class="title">前端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/ajax/" class="nav-link">
  ajax
</a></li><li class="dropdown-item"><!----> <a href="/angular/" class="nav-link">
  angular
</a></li><li class="dropdown-item"><!----> <a href="/3d/" class="nav-link">
  3d
</a></li><li class="dropdown-item"><!----> <a href="/basic/" class="nav-link router-link-active">
  basic
</a></li><li class="dropdown-item"><!----> <a href="/canvas/" class="nav-link">
  canvas
</a></li><li class="dropdown-item"><!----> <a href="/chart/" class="nav-link">
  chart
</a></li><li class="dropdown-item"><!----> <a href="/css/" class="nav-link">
  css
</a></li><li class="dropdown-item"><!----> <a href="/d3/" class="nav-link">
  d3
</a></li><li class="dropdown-item"><!----> <a href="/es6/" class="nav-link">
  es6
</a></li><li class="dropdown-item"><!----> <a href="/fast/" class="nav-link">
  fast
</a></li><li class="dropdown-item"><!----> <a href="/htmlcss/" class="nav-link">
  htmlcss
</a></li><li class="dropdown-item"><!----> <a href="/jsstore/" class="nav-link">
  jsstore
</a></li><li class="dropdown-item"><!----> <a href="/object/" class="nav-link">
  object
</a></li><li class="dropdown-item"><!----> <a href="/plugin/" class="nav-link">
  plugin
</a></li><li class="dropdown-item"><!----> <a href="/react/" class="nav-link">
  react
</a></li><li class="dropdown-item"><!----> <a href="/svg/" class="nav-link">
  svg
</a></li><li class="dropdown-item"><!----> <a href="/ssr/" class="nav-link">
  ssr
</a></li><li class="dropdown-item"><!----> <a href="/test/" class="nav-link">
  test
</a></li><li class="dropdown-item"><!----> <a href="/typescript/" class="nav-link">
  Typescript
</a></li><li class="dropdown-item"><!----> <a href="/ui/" class="nav-link">
  ui
</a></li><li class="dropdown-item"><!----> <a href="/vue/" class="nav-link">
  vue
</a></li><li class="dropdown-item"><!----> <a href="/webdb/" class="nav-link">
  webdb
</a></li><li class="dropdown-item"><!----> <a href="/webpack/" class="nav-link">
  webpack
</a></li><li class="dropdown-item"><!----> <a href="/webrtc/" class="nav-link">
  webrtc
</a></li><li class="dropdown-item"><!----> <a href="/wx/" class="nav-link">
  wx
</a></li><li class="dropdown-item"><!----> <a href="/phone/" class="nav-link">
  phone
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="后端" class="dropdown-title"><span class="title">后端</span> <span class="arrow down"></span></button> <button type="button" aria-label="后端" class="mobile-dropdown-title"><span class="title">后端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/node/" class="nav-link">
  node
</a></li><li class="dropdown-item"><!----> <a href="/koa/" class="nav-link">
  koa
</a></li><li class="dropdown-item"><!----> <a href="/mongo/" class="nav-link">
  mongo
</a></li><li class="dropdown-item"><!----> <a href="/mysql/" class="nav-link">
  mysql
</a></li><li class="dropdown-item"><!----> <a href="/http/" class="nav-link">
  http
</a></li><li class="dropdown-item"><!----> <a href="/nginx/" class="nav-link">
  nginx
</a></li><li class="dropdown-item"><!----> <a href="/other/" class="nav-link">
  other
</a></li><li class="dropdown-item"><!----> <a href="/python/" class="nav-link">
  python
</a></li><li class="dropdown-item"><!----> <a href="/mk/" class="nav-link">
  mk
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="其他" class="dropdown-title"><span class="title">其他</span> <span class="arrow down"></span></button> <button type="button" aria-label="其他" class="mobile-dropdown-title"><span class="title">其他</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/reactnative/" class="nav-link">
  reactnative
</a></li><li class="dropdown-item"><!----> <a href="/s100/" class="nav-link">
  question
</a></li><li class="dropdown-item"><!----> <a href="/hmos/" class="nav-link">
  hmos
</a></li><li class="dropdown-item"><!----> <a href="/book/" class="nav-link">
  book
</a></li><li class="dropdown-item"><!----> <a href="/confusing/" class="nav-link">
  confusing
</a></li><li class="dropdown-item"><!----> <a href="/tool/" class="nav-link">
  tool
</a></li><li class="dropdown-item"><!----> <a href="/increase/" class="nav-link">
  increase
</a></li><li class="dropdown-item"><!----> <a href="/write/" class="nav-link">
  write
</a></li><li class="dropdown-item"><!----> <a href="/interview/" class="nav-link">
  interview
</a></li><li class="dropdown-item"><!----> <a href="https://github.com/weishell/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://gitee.com/weishell/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  gitee
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/basic/" aria-current="page" class="sidebar-link">基础</a></li><li><a href="/basic/001callapply.html" class="sidebar-link"> call apply bind</a></li><li><a href="/basic/002scope.html" class="sidebar-link">作用域</a></li><li><a href="/basic/003import.html" class="sidebar-link"> es6和commonjs导入导出</a></li><li><a href="/basic/004closure.html" class="sidebar-link"> 闭包</a></li><li><a href="/basic/005string.html" class="sidebar-link">string</a></li><li><a href="/basic/006forin.html" class="sidebar-link">for-in for-of</a></li><li><a href="/basic/007compatible.html" class="sidebar-link"> js兼容</a></li><li><a href="/basic/008bubble.html" class="sidebar-link">冒泡和捕获</a></li><li><a href="/basic/009regular.html" class="sidebar-link"> 正则表达式</a></li><li><a href="/basic/010jszxjz.html" class="sidebar-link">js执行机制</a></li><li><a href="/basic/011dom.html" class="sidebar-link"> dom操作</a></li><li><a href="/basic/012client.html" class="sidebar-link"> 屏幕</a></li><li><a href="/basic/013typeof.html" class="sidebar-link"> 判断数据类型</a></li><li><a href="/basic/014optimization.html" aria-current="page" class="active sidebar-link"> 性能优化</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/basic/014optimization.html#浏览器显示页面的原理" class="sidebar-link">浏览器显示页面的原理</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/basic/014optimization.html#后台在传输途径压缩" class="sidebar-link">后台在传输途径压缩</a></li><li class="sidebar-sub-header"><a href="/basic/014optimization.html#避免页面中空的-href-和-src" class="sidebar-link">避免页面中空的 href 和 src</a></li><li class="sidebar-sub-header"><a href="/basic/014optimization.html#控制资源文件加载优先级" class="sidebar-link">控制资源文件加载优先级</a></li><li class="sidebar-sub-header"><a href="/basic/014optimization.html#利用浏览器缓存" class="sidebar-link">利用浏览器缓存</a></li><li class="sidebar-sub-header"><a href="/basic/014optimization.html#减少重排-回流-reflow" class="sidebar-link">减少重排(回流)(Reflow)</a></li><li class="sidebar-sub-header"><a href="/basic/014optimization.html#避免触发同步布局事件" class="sidebar-link">避免触发同步布局事件</a></li><li class="sidebar-sub-header"><a href="/basic/014optimization.html#服务端渲染" class="sidebar-link">服务端渲染</a></li><li class="sidebar-sub-header"><a href="/basic/014optimization.html#懒加载和预加载" class="sidebar-link">懒加载和预加载</a></li><li class="sidebar-sub-header"><a href="/basic/014optimization.html#阻塞渲染" class="sidebar-link">阻塞渲染</a></li><li class="sidebar-sub-header"><a href="/basic/014optimization.html#优化隐藏类和删除操作" class="sidebar-link">优化隐藏类和删除操作</a></li><li class="sidebar-sub-header"><a href="/basic/014optimization.html#静态分配与对象池" class="sidebar-link">静态分配与对象池 ？？</a></li><li class="sidebar-sub-header"><a href="/basic/014optimization.html#代码解耦" class="sidebar-link">代码解耦</a></li></ul></li></ul></li><li><a href="/basic/014optimization1.html" class="sidebar-link">前端性能优化2</a></li><li><a href="/basic/015trash.html" class="sidebar-link"> 垃圾回收机制</a></li><li><a href="/basic/016MutationObserver.html" class="sidebar-link">MutationObserver</a></li><li><a href="/basic/017crossdomain.html" class="sidebar-link"> 跨域解决办法</a></li><li><a href="/basic/018compatMode.html" class="sidebar-link"> 文档渲染模式</a></li><li><a href="/basic/019jsnotuse.html" class="sidebar-link"> 不宜使用的Javascript语法</a></li><li><a href="/basic/020jdlx.html" class="sidebar-link">dom的节点类型</a></li><li><a href="/basic/021jquery.html" class="sidebar-link"> jquery基本api</a></li><li><a href="/basic/022className.html" class="sidebar-link">className</a></li><li><a href="/basic/023array.html" class="sidebar-link"> 数组</a></li><li><a href="/basic/024json.html" class="sidebar-link"> json</a></li><li><a href="/basic/025eval.html" class="sidebar-link"> eval函数</a></li><li><a href="/basic/026window.html" class="sidebar-link">window</a></li><li><a href="/basic/027navigator.html" class="sidebar-link"> 浏览器</a></li><li><a href="/basic/028recursion.html" class="sidebar-link"> 递归</a></li><li><a href="/basic/029valueof.html" class="sidebar-link"> valueOf和toString</a></li><li><a href="/basic/030copy.html" class="sidebar-link"> 深拷贝和浅拷贝</a></li><li><a href="/basic/031jiami.html" class="sidebar-link">前端加密问题</a></li><li><a href="/basic/032queryparams.html" class="sidebar-link"> query和params传参</a></li><li><a href="/basic/033attach.html" class="sidebar-link">前端的恶意攻击方式</a></li><li><a href="/basic/034cookie.html" class="sidebar-link">cookie和session</a></li><li><a href="/basic/035jsengin.html" class="sidebar-link">js引擎</a></li><li><a href="/basic/036iframe.html" class="sidebar-link">iframe</a></li><li><a href="/basic/037js.html" class="sidebar-link">js基础类型</a></li><li><a href="/basic/038virtual.html" class="sidebar-link">虚拟DOM</a></li><li><a href="/basic/039shadowroot.html" class="sidebar-link">shadowroot</a></li><li><a href="/basic/040yuju.html" class="sidebar-link">语句</a></li><li><a href="/basic/041resnetwork.html" class="sidebar-link">控制台与后台返回数据不一致</a></li><li><a href="/basic/042throttle.html" class="sidebar-link">节流和去抖动</a></li><li><a href="/basic/043ftl.html" class="sidebar-link">ftl</a></li><li><a href="/basic/044console.html" class="sidebar-link">console</a></li><li><a href="/basic/045encode.html" class="sidebar-link">解码编码</a></li><li><a href="/basic/046event.html" class="sidebar-link">js事件</a></li><li><a href="/basic/047script.html" class="sidebar-link">script标签上的属性</a></li><li><a href="/basic/048requestAnimationFrame.html" class="sidebar-link">requestAnimationFrame</a></li><li><a href="/basic/049sort.html" class="sidebar-link">排序</a></li><li><a href="/basic/050mistake.html" class="sidebar-link">js控制台的常见错误类型</a></li><li><a href="/basic/051requestIdleCallback.html" class="sidebar-link">requestIdleCallback</a></li><li><a href="/basic/052xnyh.html" class="sidebar-link">性能优化总结</a></li><li><a href="/basic/053event.html" class="sidebar-link">事件event</a></li><li><a href="/basic/055function.html" class="sidebar-link">函数</a></li><li><a href="/basic/056mobile.html" class="sidebar-link">移动端问题处理</a></li><li><a href="/basic/057Performance.html" class="sidebar-link">Performance调试</a></li><li><a href="/basic/058browser.html" class="sidebar-link">浏览器</a></li><li><a href="/basic/059sjjg.html" class="sidebar-link">数据结构</a></li><li><a href="/basic/099jsaboutdontknow.html" class="sidebar-link"> 你不知道的js</a></li><li><a href="/basic/100es6+.html" class="sidebar-link">es6+</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="前端性能优化"><a href="#前端性能优化" class="header-anchor">#</a> 前端性能优化</h1> <p>在前端领域，性能问题常常同样表现为空间和时间两种，顾名思义：</p> <ul><li><p>空间性能问题可同样理解为内存占用、CPU 占用、本地缓存占用过多带来的问题（如卡顿）；</p></li> <li><p>时间性能问题则意味着用户等待时间过长，包括页面加载、渲染、可交互等耗时。</p></li></ul> <div class="el-image"><div class="el-image__placeholder"></div><!----></div> <h2 id="浏览器显示页面的原理"><a href="#浏览器显示页面的原理" class="header-anchor">#</a> 浏览器显示页面的原理</h2> <p>浏览器内核可以分成两部分：渲染引擎（Layout Engine 或者 Rendering Engine）和 JS 引擎。早期渲染引擎和 JS 引擎没有十分明确区分，但随着 JS 引擎越来越独立，内核成了渲染引擎的代称。</p> <div class="custom-block tip"><p class="custom-block-title">基本流程:</p> <ul><li>获取 HTML 文档及样式表文件</li> <li>解析成对应的树形数据结构
1.DOM tree
2.CSSOM tree</li> <li>计算可见节点形成 render tree</li> <li>计算 DOM 的形状及位置进行布局</li> <li>将每个节点转化为实际像素绘制到视口上（栅格化）
render tree（页面显示最终结果）是由 DOM tree与 CSSOM tree 合并并剔除不可见的节点所形成的，其中不包含如下节点：</li></ul></div> <p>1.本身不可见的</p> <ul><li>html</li> <li>head</li> <li>meta</li> <li>link</li> <li>style</li> <li>script</li></ul> <p>2.设置了 display: none 样式的</p> <div class="custom-block warning"><p class="custom-block-title">注意</p> <p>一些通过css进行隐藏的节点。比如display:none。注意，利用visibility和opacity隐藏的节点，还是会显示在渲染树上的。</p></div> <p>资源加载：</p> <div class="custom-block tip"><p class="custom-block-title">提示</p> <p><strong>执行 JavaScript 会阻止 DOM tree 构建
加载 CSS 会阻止 render tree 构建</strong></p></div> <p>影响性能的因素：</p> <ul><li>白屏</li> <li>HTML 和 CSS 的加载及解析速度</li> <li>head 内的脚本加载及执行</li> <li>首屏</li> <li>图片加载</li> <li>body 内的脚本加载及执行</li> <li>render tree 的构建</li> <li>HTML 的复杂度</li> <li>CSS 的复杂度</li> <li>render tree 的绘制（栅格化）</li> <li><strong>颜色的复杂度</strong></li> <li><strong>形状的复杂度</strong></li></ul> <h4 id="优化选择器"><a href="#优化选择器" class="header-anchor">#</a> 优化选择器</h4> <p><em><strong>CSS 选择符是从右到左进行匹配的</strong></em></p> <div class="language-css extra-class"><pre class="language-css"><code><span class="token selector">#myList li</span><span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token comment">/*× 浏览器必须遍历页面上每个 li 元素，并且每次都要去确认这个 li 元素的父元素 id 是不是 myList*/</span>
<span class="token selector">.myList_li</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token comment">/*√*/</span>

.myList#title<span class="token comment">/*×不要画蛇添足，id 和 class 选择器不应该被多余的标签选择器拖后腿*/</span>
#title<span class="token comment">/*√*/</span>
</code></pre></div><h4 id="减少-http-请求数量"><a href="#减少-http-请求数量" class="header-anchor">#</a> 减少 HTTP 请求数量</h4> <p><a href="https://blog.csdn.net/weixin_39841838/article/details/120124706" target="_blank" rel="noopener noreferrer">精灵图弃用<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> <a href="https://blog.csdn.net/qq_32766999/article/details/124452235" target="_blank" rel="noopener noreferrer">浏览器与http创建TCP链接<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <div class="el-image" style="width:500px;"><div class="el-image__placeholder"></div><!----></div> <div class="custom-block tip"><p class="custom-block-title">解析</p> <p>基本原理：浏览器与服务器需要经过三次握手，每次握手需要花费大量时间。而且不同浏览器对资源文件并发请求数量有限（不同浏览器允许并发数），一旦 HTTP 请求数量达到一定数量，资源请求就存在等待状态，这是很致命的，因此减少 HTTP 的请求数量可以很大程度上对网站性能进行优化。</p></div> <div class="custom-block tip"><p class="custom-block-title">措施</p> <p>1.CSS Sprites：CSS 精灵</p> <p>2.合并 CSS 和 JS 文件。</p> <p>3.采用 lazyLoad：俗称懒加载，比如滑动到页面相应高度再加载图片。</p></div> <div class="el-image" style="width:660px;"><div class="el-image__placeholder"></div><!----></div> <p>每一个 HTTP 请求在发送出去之前，都会经历一次 TCP 三次握手的过程，当数据传输完毕，又进行一次四次挥手的过程，是不是贼麻烦？</p> <p>严格意义上来说，合并文件这种性能优化手段，在 HTTP 1.1 推出后，就应该受到质疑了。HTTP 1.1 版本默认支持长连接（Connection：keep-alive）和流水线请求（Pipelining），也就是说，多个 HTTP 请求可以依次共享同一个 TCP 连接，大大减少了建立 TCP 连接时的消耗和延迟。</p> <p>2015 年，HTTP 2.0 横空出世，带着多路复用的光环来了，不仅解决了 HTTP 1.1 流水线请求会造成的请求阻塞的问题，更重要的是，多路并行，更快了！</p> <p>在现代前端工程里，没有必要做这种「合并文件以减少 HTTP 请求」的“优化”，相反的，现在的前端应用都很大，反而需要用到「分包加载」和「懒加载」等手段，减少每个静态文件的实际体积，这样才能获得更快的下载速度以及在浏览器端获得更快的解析速度。</p> <p>Chrome 最多允许对同一个 Host 建立六个 TCP 连接。不同的浏览器有一些区别。</p> <div class="el-image" style="width:360px;display:inline-block;"><div class="el-image__placeholder"></div><!----></div> <div class="el-image" style="width:360px;display:inline-block;"><div class="el-image__placeholder"></div><!----></div> <h4 id="压缩js-css-html-图片-避免使用css表达式"><a href="#压缩js-css-html-图片-避免使用css表达式" class="header-anchor">#</a> 压缩js,css,html，图片 避免使用CSS表达式</h4> <p>webpack等工具，图片根据需求寻求jpg或者svg，base64,png;代码按需加载，还可以代码减重(tree shaking)</p> <h3 id="后台在传输途径压缩"><a href="#后台在传输途径压缩" class="header-anchor">#</a> 后台在传输途径压缩</h3> <blockquote><p>前端压缩的文件，其实再下载的时候，后台返回时也可以继续压缩，原本已经压缩的dist.min.js有大约46kb[资源大小],后台如node使用compression继续压缩后仅仅只有17kb(本地测试把文件达成zip包也是差不多17kb[network传输])</p></blockquote> <div class="el-image"><div class="el-image__placeholder"></div><!----></div> <div class="el-image"><div class="el-image__placeholder"></div><!----></div> <p>304有缓存页面加载的那么快，传输所占用的体积已经是非常小了,但是图片不建议gzip缓存。首先，HTTP压缩需要成本。Web服务器获得需要的内容，然后压缩它，最后将它发送到客户端。如果内容不能被进一步压缩，你只是在浪费CPU做无意义的任务。其次，采用HTTP压缩已经被过压缩的东西并不能使它更小。事实上，添加标头，压缩字典，并校验响应体实际上使它变得更大</p> <h3 id="避免页面中空的-href-和-src"><a href="#避免页面中空的-href-和-src" class="header-anchor">#</a> 避免页面中空的 href 和 src</h3> <div class="custom-block warning"><p class="custom-block-title">解析</p> <p>避免使用空的 src 属性确实可以缩减浏览器首屏渲染的时间，因为浏览器在渲染过程中会把 src 属性中的空内容进行加载，直至加载失败，影响 DOMContentLoaded 与 Loaded 事件之间的资源准备过程，拉长了首屏渲染所用的时间；但空的 href 属性对首屏渲染的影响比较小。</p></div> <h3 id="控制资源文件加载优先级"><a href="#控制资源文件加载优先级" class="header-anchor">#</a> 控制资源文件加载优先级</h3> <p>基本原理：说到这里就需要知道浏览器加载 HTML 内容的原理，浏览器在加载 HTML 内容时，是将 HTML 内容从上至下依次解析，解析到 link 或者 script 标签就会加载 href 或者 src 对应链接内容，为了第一时间展示页面给用户，就需要将 CSS 提前加载，不要受 JS 加载影响。</p> <h3 id="利用浏览器缓存"><a href="#利用浏览器缓存" class="header-anchor">#</a> 利用浏览器缓存</h3> <p>基本原理：浏览器缓存分强缓存和协商缓存，他们是将网络资源存储在本地，等待下次请求该资源时，如果命中就不需要到服务器重新请求该资源，直接在本地读取该资源。</p> <div class="custom-block tip"><p class="custom-block-title">类型</p> <ul><li>强缓存：在 web 服务器返回的响应中添加 Expires 和 Cache-Control Header。</li> <li>协商缓存：通过【Last-Modified，If-Modified-Since】和【ETag、If-None-Match】这两对 Header 分别管理。</li> <li>本地缓存 cookie localstorage indexdb</li></ul></div> <ul><li>强缓存：<code>不会向服务器发送请求</code>，直接从缓存中读取资源，在chrome控制台的network选项中可以看到该请求返回<code>200</code>的状态码;</li> <li>协商缓存：<code>向服务器发送请求</code>，服务器会根据这个请求的request header的一些参数来判断是否命中协商缓存，如果命中，则返回304状态码并带上新的response header通知浏览器从缓存中读取资源；</li> <li>两者的共同点是，都是从客户端缓存中读取资源；区别是强缓存不会发请求，协商缓存会发请求</li></ul> <h4 id="搞懂前端缓存"><a href="#搞懂前端缓存" class="header-anchor">#</a> 搞懂前端缓存</h4> <p>总的来说：</p> <ul><li>如果开启了Service Worker首先会从<code>Service Worker</code>中拿</li> <li>如果新开一个以前打开过的页面缓存会从<code>Disk Cache</code>中拿（前提是命中强缓存）</li> <li>刷新当前页面时浏览器会根据当前运行环境内存来决定是从 Memory Cache 还是 从Disk Cache中拿(可以看到下图最后几个文件有时候是从 Memory Cache中拿有时候是从Disk Cache中拿)</li></ul> <div class="el-image"><div class="el-image__placeholder"></div><!----></div> <h4 id="前端缓存-后端缓存"><a href="#前端缓存-后端缓存" class="header-anchor">#</a> 前端缓存/后端缓存</h4> <div class="el-image"><div class="el-image__placeholder"></div><!----></div> <p>基本的网络请求就是三个步骤：请求，处理，响应。</p> <p>后端缓存主要集中于“处理”步骤，<code>通过保留数据库连接，存储处理结果</code>等方式缩短处理时间，尽快进入“响应”步骤。</p> <p>而前端缓存则可以在剩下的两步：“请求”和“响应”中进行。在“请求”步骤中，浏览器也可以通过<code>存储结果</code>的方式直接使用资源，<code>直接省去了发送请求</code>；而“响应”步骤需要<code>浏览器和服务器</code>共同配合，<code>通过减少响应内容来缩短传输时间</code>。</p> <ul><li>按缓存位置分类 (memory cache, disk cache, Service Worker 等)</li> <li>按失效策略分类 (Cache-Control, ETag 等)</li> <li>缓存的应用模式</li></ul> <ol><li>按缓存位置分类</li></ol> <p>可以在 Chrome 的开发者工具中，Network -&gt; Size 一列看到一个请求最终的处理方式：如果是大小 (多少 K， 多少 M 等) 就表示是网络请求，否则会列出 from memory cache, from disk cache 和 from ServiceWorker。</p> <p>它们的优先级是：(由上到下寻找，找到即返回；找不到则继续)</p> <ul><li>Service Worker</li> <li>Memory Cache</li> <li>Disk Cache</li> <li>网络请求</li></ul> <hr> <ul><li>memory cache</li></ul> <p>memory cache 是内存中的缓存，(与之相对 disk cache 就是硬盘上的缓存)。按照操作系统的常理：先读内存，再读硬盘。  (disk cache因为它的优先级更低一些)e。</p> <p><em><strong>几乎所有的网络请求资源都会被浏览器自动加入到 memory cache 中。但是也正因为数量很大但是浏览器占用的内存不能无限扩大这样两个因素，memory cache 注定只能是个“短期存储”。</strong></em> 常规情况下，浏览器的 TAB 关闭后该次浏览的 memory cache 便告失效 (为了给其他 TAB 腾出位置)。而如果极端情况下 (例如一个页面的缓存就占用了超级多的内存)，那可能在 TAB 没关闭之前，排在前面的缓存就已经失效了。</p> <p>刚才提过，几乎所有的请求资源 都能进入 memory cache，这里细分一下主要有两块：</p> <ul><li><code>preloader</code>。</li></ul> <p>在浏览器打开网页的过程中，会先请求 HTML 然后解析。之后如果浏览器发现了 js, css 等需要解析和执行的资源时，它会使用 CPU 资源对它们进行解析和执行。在古老的年代(大约 2007 年以前)，“请求 js/css - 解析执行 - 请求下一个 js/css - 解析执行下一个 js/css” 这样的“串行”操作模式在每次打开页面之前进行着。很明显在解析执行的时候，网络请求是空闲的，这就有了发挥的空间：能不能一边解析执行 js/css，一边去请求下一个(或下一批)资源呢？</p> <p>这就是 preloader 要做的事情。不过 preloader 没有一个官方标准，所以每个浏览器的处理都略有区别。例如有些浏览器还会下载 css 中的 @import 内容 poster等。</p> <p>而这些被 preloader 请求够来的资源就会被放入 memory cache 中，供之后的解析执行操作使用。</p> <ul><li><code>preload</code>(虽然看上去和刚才的 preloader 就差了俩字母)。实际上这个大家应该更加熟悉一些。<code>这些显式指定的预加载资源，也会被放入 memory cache 中</code>。</li></ul> <p><strong>memory cache 机制保证了一个页面中如果有两个相同的请求 (例如两个 src 相同的 ，两个href相同的)都实际只会被请求最多一次，避免浪费。</strong></p> <p>不过在匹配缓存时，除了匹配完全相同的 URL 之外，还会比对他们的类型，CORS 中的域名规则等。因此一个作为脚本 (script) 类型被缓存的资源是不能用在图片 (image) 类型的请求中的，即便他们 src 相等。</p> <p>在从 memory cache 获取缓存内容时，浏览器会忽视例如 max-age=0, no-cache 等头部配置。例如页面上存在几个相同 src 的图片，即便它们可能被设置为不缓存，但依然会从 memory cache 中读取。这是因为 memory cache 只是短期使用，大部分情况生命周期只有一次浏览而已。而 max-age=0 在语义上普遍被解读为“不要在下次浏览时使用”，所以和 memory cache 并不冲突。</p> <p>但如果站长是真心不想让一个资源进入缓存，就连短期也不行，那就需要使用 <code>no-store</code>。存在这个头部配置的话，即便是 memory cache 也不会存储，自然也不会从中读取了。(后面的第二个示例有关于这点的体现)</p> <ul><li>disk cache</li></ul> <p>disk cache 也叫 <strong>HTTP cache</strong> ，顾名思义是存储在硬盘上的缓存，因此它是持久存储的，是实际存在于文件系统中的。而且它允许相同的资源在跨会话，<code>甚至跨站点的情况下使用，例如两个站点都使用了同一张图片。</code></p> <p>disk cache 会严格根据 HTTP 头信息中的各类字段来判定哪些资源可以缓存，哪些资源不可以缓存；哪些资源是仍然可用的，哪些资源是过时需要重新请求的。当命中缓存之后，浏览器会从硬盘中读取资源，虽然比起从内存中读取慢了一些，但比起网络请求还是快了不少的。<em><strong>绝大部分的缓存都来自 disk cache。</strong></em></p> <p>关于 HTTP 的协议头中的缓存字段，我们会在稍后进行详细讨论。</p> <p>凡是持久性存储都会面临容量增长的问题，disk cache 也不例外。在浏览器自动清理时，会有神秘的算法去把“最老的”或者“最可能过时的”资源删除，因此是一个一个删除的。不过每个浏览器识别“最老的”和“最可能过时的”资源的算法不尽相同，可能也是它们差异性的体现。</p> <ul><li>Service Worker</li></ul> <p>上述的缓存策略以及缓存/读取/失效的动作都是由浏览器内部判断 &amp; 进行的，我们只能设置响应头的某些字段来告诉浏览器，而不能自己操作。举个生活中去银行存/取钱的例子来说，你只能告诉银行职员，我要存/取多少钱，然后把由他们会经过一系列的记录和手续之后，把钱放到金库中去，或者从金库中取出钱来交给你。</p> <p>但 Service Worker 的出现，给予了一种更加灵活，更加直接的操作方式。依然以存/取钱为例，我们现在可以绕开银行职员，自己走到金库前(当然是有别于上述金库的一个单独的小金库)，自己把钱放进去或者取出来。因此我们可以选择放哪些钱(缓存哪些文件)，什么情况把钱取出来(路由匹配规则)，取哪些钱出来(缓存匹配并返回)。</p> <p>Service Worker 能够操作的缓存是有别于浏览器内部的 memory cache 或者 disk cache 的。可以从 Chrome 的 F12 中，<code>Application -&gt; Cache Storage</code>找到这个单独的“小金库”。除了位置不同之外，这个缓存是永久性的，即关闭 TAB 或者浏览器，下次打开依然还在(而 memory cache 不是)。有两种情况会导致这个缓存中的资源被清除：手动调用 API cache.delete(resource) 或者容量超过限制，被浏览器全部清空。</p> <p>如果 Service Worker 没能命中缓存，一般情况会使用 fetch() 方法继续获取资源。这时候，浏览器就去 memory cache 或者 disk cache 进行下一次找缓存的工作了。注意：经过 Service Worker 的 fetch() 方法获取的资源，即便它并没有命中 Service Worker 缓存，甚至实际走了网络请求，也会标注为 from ServiceWorker。</p> <ul><li>请求网络</li></ul> <p>如果一个请求在上述 3 个位置都没有找到缓存，那么浏览器会正式发送网络请求去获取内容。之后容易想到，为了提升之后请求的缓存命中率，自然要把这个资源添加到缓存中去。具体来说：</p> <ul><li>根据 Service Worker 中的 handler 决定是否存入 Cache Storage (额外的缓存位置)。</li> <li>根据 HTTP 头部的相关字段(Cache-control, Pragma 等)决定是否存入 disk cache</li> <li>memory cache 保存一份资源 的引用，以备下次使用。</li></ul> <ol start="2"><li>按失效策略分类</li></ol> <p>memory cache 是浏览器为了加快读取缓存速度而进行的自身的优化行为，不受开发者控制，也不受 HTTP 协议头的约束，算是一个黑盒。Service Worker 是由开发者编写的额外的脚本，且缓存位置独立，出现也较晚，使用还不算太广泛。所以平时最为熟悉的其实是 disk cache，也叫 HTTP cache (因为不像 memory cache，它遵守 HTTP 协议头中的字段)。平时所说的强制缓存，对比缓存，以及 Cache-Control 等，也都归于此类。</p> <p>I 强制缓存 (也叫强缓存)</p> <p>强制缓存的含义是，当客户端请求后，会先访问缓存数据库看缓存是否存在。如果存在则直接返回；不存在则请求真的服务器，响应后再写入缓存数据库。</p> <p><code>强制缓存直接减少请求数，是提升最大的缓存策略。</code> 它的优化覆盖了文章开头提到过的请求数据的全部三个步骤。如果考虑使用缓存来优化网页性能的话，强制缓存应该是首先被考虑的。</p> <p>可以造成强制缓存的字段是 <code>Cache-control 和 Expires。</code></p> <ul><li>Expires
这是 HTTP 1.0 的字段，表示缓存到期时间，是一个绝对的时间 (当前时间+缓存时间)，如</li></ul> <div class="language- extra-class"><pre class="language-text"><code>Expires: Thu, 10 Nov 2017 08:45:11 GMT
</code></pre></div><p>在响应消息头中，设置这个字段之后，就可以告诉浏览器，在未过期之前不需要再次请求。</p> <p>但是，这个字段设置时有两个缺点：</p> <p>①由于是绝对时间，用户可能会将客户端本地的时间进行修改，而导致浏览器判断缓存失效，重新请求该资源。此外，即使不考虑自信修改，时差或者误差等因素也可能造成客户端与服务端的时间不一致，致使缓存失效。</p> <p>②写法太复杂了。表示时间的字符串多个空格，少个字母，都会导致非法属性从而设置失效。</p> <ul><li>Cache-control
已知Expires的缺点之后，在HTTP/1.1中，增加了一个字段Cache-control，该字段表示资源缓存的最大有效时间，在该时间内，客户端不需要向服务器发送请求</li></ul> <p>这两者的区别就是前者是绝对时间，而后者是相对时间。如下：</p> <div class="language- extra-class"><pre class="language-text"><code>Cache-control: max-age=2592000
</code></pre></div><p>下面列举一些 Cache-control 字段常用的值：(完整的列表可以查看 MDN)</p> <ul><li>max-age：即最大有效时间</li> <li>must-revalidate：如果超过了 max-age 的时间，浏览器必须向服务器发送请求，验证资源是否还有效。</li> <li>no-cache：虽然字面意思是“不要缓存”，但实际上还是要求客户端缓存内容的，只是是否使用这个内容由后续的对比来决定。</li> <li>no-store: <code>真正意义上的“不要缓存”。所有内容都不走缓存，包括强制和对比。</code></li> <li>public：所有的内容都可以被缓存 (包括客户端和代理服务器， 如 CDN)</li> <li>private：所有的内容只有客户端才可以缓存，代理服务器不能缓存。默认值。</li></ul> <p>这些值可以混合使用，例如 Cache-control:public, max-age=2592000。在混合使用时，它们的优先级如下图.</p> <div class="el-image"><div class="el-image__placeholder"></div><!----></div> <p>这里有一个疑问：max-age=0 和 no-cache 等价吗？从规范的字面意思来说，max-age 到期是 应该重新验证，而 no-cache 是 必须重新验证。但实际情况以浏览器实现为准，大部分情况他们俩的行为还是一致的。（如果是 max-age=0, must-revalidate 就和 no-cache 等价了）</p> <p>顺带一提，在 HTTP/1.1 之前，如果想使用 no-cache，通常是使用 Pragma 字段，如 Pragma: no-cache(这也是 Pragma 字段唯一的取值)。但是这个字段只是浏览器约定俗成的实现，并没有确切规范，因此缺乏可靠性。它应该只作为一个兼容字段出现，在当前的网络环境下其实用处已经很小。</p> <p>总结一下，自从 HTTP/1.1 开始，Expires 逐渐被 Cache-control 取代。Cache-control 是一个相对时间，即使客户端时间发生改变，相对时间也不会随之改变，这样可以保持服务器和客户端的时间一致性。而且 Cache-control 的可配置性比较强大。</p> <p>Cache-control 的优先级高于 Expires，为了兼容 HTTP/1.0 和 HTTP/1.1，实际项目中两个字段我们都会设置。</p> <p>II 对比缓存 (也叫协商缓存)</p> <p>当强制缓存失效(超过规定时间)时，就需要使用对比缓存，由服务器决定缓存内容是否失效。</p> <p>流程上说，浏览器先请求缓存数据库，返回一个缓存标识。之后浏览器拿这个标识和服务器通讯。如果缓存未失效，则返回 <code>HTTP 状态码 304</code> 表示继续使用，于是客户端继续使用缓存；如果失效，则返回新的数据和缓存规则，浏览器响应数据后，再把规则写入到缓存数据库。</p> <p>对比缓存在请求数上和没有缓存是一致的，但如果是 304 的话，返回的仅仅是一个状态码而已，并没有实际的文件内容，因此 在响应体体积上的节省是它的优化点。它的优化覆盖了文章开头提到过的请求数据的三个步骤中的最后一个：<code>“响应”</code>。通过减少响应体体积，来缩短网络传输时间。所以和强制缓存相比提升幅度较小，但总比没有缓存好。</p> <p>对比缓存是可以和强制缓存一起使用的，作为在强制缓存失效后的一种后备方案。实际项目中他们也的确经常一同出现。</p> <p>对比缓存有 2 组字段(不是两个)：</p> <ul><li>Last-Modified &amp; If-Modified-Since</li></ul> <ol><li>服务器通过 Last-Modified 字段告知客户端，资源最后一次被修改的时间，例如</li></ol> <div class="language- extra-class"><pre class="language-text"><code>Last-Modified: Mon, 10 Nov 2018 09:10:11 GMT
</code></pre></div><ol start="2"><li><p>浏览器将这个值和内容一起记录在缓存数据库中。</p></li> <li><p>下一次请求相同资源时时，浏览器从自己的缓存中找出“不确定是否过期的”缓存。因此在请求头中将上次的 Last-Modified 的值写入到请求头的 If-Modified-Since 字段</p></li> <li><p>服务器会将 If-Modified-Since 的值与 Last-Modified 字段进行对比。如果相等，则表示未修改，响应 304；反之，则表示修改了，响应 200 状态码，并返回数据。</p></li></ol> <p>但是他还是有一定缺陷的：</p> <p>①如果资源更新的速度是秒以下单位，那么该缓存是不能被使用的，因为它的时间单位最低是秒。</p> <p>②如果文件是通过服务器动态生成的，那么该方法的更新时间永远是生成的时间，尽管文件可能没有变化，所以起不到缓存的作用。</p> <ul><li>Etag &amp; If-None-Match</li></ul> <p>为了解决上述问题，出现了一组新的字段 Etag 和 If-None-Match</p> <p>Etag 存储的是文件的特殊标识(一般都是 hash 生成的)，服务器存储着文件的 Etag 字段。之后的流程和 Last-Modified 一致，只是 Last-Modified 字段和它所表示的更新时间改变成了 Etag 字段和它所表示的文件 hash，把 If-Modified-Since 变成了 If-None-Match。服务器同样进行比较，命中返回 304, 不命中返回新资源和 200。</p> <p><code>Etag 的优先级高于 Last-Modified</code></p> <h4 id="缓存小结"><a href="#缓存小结" class="header-anchor">#</a> 缓存小结</h4> <p>当浏览器要请求资源时</p> <ul><li>调用 Service Worker 的 fetch 事件响应</li> <li>查看 memory cache</li> <li>查看 disk cache。这里又细分：
<ul><li>如果有强制缓存且未失效，则使用强制缓存，不请求服务器。这时的状态码全部是 200</li> <li>如果有强制缓存但已失效，使用对比缓存，比较后确定 304 还是 200</li></ul></li> <li>发送网络请求，等待网络响应
<ul><li>把响应内容存入 disk cache (如果 HTTP 头信息配置可以存的话)</li> <li>把响应内容 的引用 存入 memory cache (无视 HTTP 头信息的配置)</li> <li>把响应内容存入 Service Worker 的 Cache Storage (如果 Service Worker 的脚本调用了 cache.put())</li></ul></li></ul> <h4 id="缓存实例"><a href="#缓存实例" class="header-anchor">#</a> 缓存实例</h4> <ul><li>memory cache &amp; disk cache</li></ul> <p>写一个简单的 index.html，然后引用 3 种资源，分别是 index.js, index.css 和 mashroom.jpg。</p> <p>给这三种资源都设置上 Cache-control: max-age=86400，表示强制缓存 24 小时。以下截图全部使用 Chrome 的隐身模式。</p> <ol><li>首次请求</li></ol> <div class="el-image"><div class="el-image__placeholder"></div><!----></div> <ol start="2"><li>再次请求 (F5)
第二次请求，三个请求都来自 memory cache。因为没有关闭 TAB，所以浏览器把缓存的应用加到了 memory cache。(耗时 0ms，也就是 1ms 以内)</li></ol> <div class="el-image"><div class="el-image__placeholder"></div><!----></div> <ol start="3"><li>关闭 TAB，打开新 TAB 并再次请求</li></ol> <div class="el-image"><div class="el-image__placeholder"></div><!----></div> <p>因为关闭了 TAB，memory cache 也随之清空。但是 disk cache 是持久的，于是所有资源来自 disk cache。(大约耗时 3ms，因为文件有点小)</p> <p>而且对比 2 和 3，很明显看到 memory cache 还是比 disk cache 快得多的。</p> <ul><li>no-cache &amp; no-store
index.html 里面一些代码，完成两个目标：</li></ul> <p>每种资源都(同步)请求两次;增加脚本异步请求图片</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token comment">&lt;!-- 把3种资源都改成请求两次 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>stylesheet<span class="token punctuation">&quot;</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>/static/index.css<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>stylesheet<span class="token punctuation">&quot;</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>/static/index.css<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>/static/index.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>/static/index.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>/static/mashroom.jpg<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>/static/mashroom.jpg<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>

<span class="token comment">&lt;!-- 异步请求图片 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> img <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'img'</span><span class="token punctuation">)</span>
        img<span class="token punctuation">.</span>src <span class="token operator">=</span> <span class="token string">'/static/mashroom.jpg'</span>
        document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>img<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>当把服务器响应设置为 <code>Cache-Control: no-cache</code> 时，我们发现打开页面之后，三种资源都只被请求 1 次。</p> <div class="el-image"><div class="el-image__placeholder"></div><!----></div> <div class="el-image"><div class="el-image__placeholder"></div><!----></div> <p>这说明两个问题：</p> <p>①同步请求方面，浏览器会自动把当次 HTML 中的资源存入到缓存 (memory cache)，这样碰到相同 src 的图片就会自动读取缓存(但不会在 Network 中显示出来)</p> <p>②异步请求方面，浏览器同样是不发请求而直接读取缓存返回。但同样不会在 Network 中显示。</p> <p>总体来说，如上面原理所述，no-cache 从语义上表示下次请求不要直接使用缓存而需要比对，并不对本次请求进行限制。因此浏览器在处理当前页面时，可以放心使用缓存。</p> <p>当把服务器响应设置为 <code>Cache-Control: no-store</code> 时，情况发生了变化，三种资源都被请求了 2 次。而图片因为还多一次异步请求，总计 3 次。(红框中的都是那一次异步请求)</p> <div class="el-image"><div class="el-image__placeholder"></div><!----></div> <div class="el-image"><div class="el-image__placeholder"></div><!----></div> <p>这同样说明：</p> <p>① 如之前原理所述，虽然 memory cache 是无视 HTTP 头信息的，但是 no-store 是特别的。在这个设置下，memory cache 也不得不每次都请求资源。</p> <p>② 异步请求和同步遵循相同的规则，在 no-store 情况下，依然是每次都发送请求，不进行任何缓存。</p> <ul><li>Service Worker &amp; memory (disk) cache</li></ul> <p>尝试把 Service Worker 也加入进去。我们编写一个 serviceWorker.js，并编写如下内容：(主要是预缓存 3 个资源，并在实际请求时匹配缓存并返回)</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// serviceWorker.js</span>
self<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'install'</span><span class="token punctuation">,</span> <span class="token parameter">e</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// 当确定要访问某些资源时，提前请求并添加到缓存中。</span>
  <span class="token comment">// 这个模式叫做“预缓存”</span>
  e<span class="token punctuation">.</span><span class="token function">waitUntil</span><span class="token punctuation">(</span>
    caches<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">'service-worker-test-precache'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">cache</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> cache<span class="token punctuation">.</span><span class="token function">addAll</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'/static/index.js'</span><span class="token punctuation">,</span> <span class="token string">'/static/index.css'</span><span class="token punctuation">,</span> <span class="token string">'/static/mashroom.jpg'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

self<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'fetch'</span><span class="token punctuation">,</span> <span class="token parameter">e</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// 缓存中能找到就返回，找不到就网络请求，之后再写入缓存并返回。</span>
  <span class="token comment">// 这个称为 CacheFirst 的缓存策略。</span>
  <span class="token keyword">return</span> e<span class="token punctuation">.</span><span class="token function">respondWith</span><span class="token punctuation">(</span>
    caches<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">'service-worker-test-precache'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">cache</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> cache<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>request<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">matchedResponse</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> matchedResponse <span class="token operator">||</span> <span class="token function">fetch</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>request<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">fetchedResponse</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          cache<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>request<span class="token punctuation">,</span> fetchedResponse<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
          <span class="token keyword">return</span> fetchedResponse
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>注册 SW 的代码这里就不赘述了。此外还给服务器设置 Cache-Control: max-age=86400 来开启 disk cache。看看两者的优先级。</p> <p>①当首次访问时，会看到常规请求之外，浏览器(确切地说是 Service Worker)额外发出了 3 个请求。这来自预缓存的代码。</p> <div class="el-image"><div class="el-image__placeholder"></div><!----></div> <p>②第二次访问(无论关闭 TAB 重新打开，还是直接按 F5 刷新)都能看到所有的请求标记为 from SerciceWorker。</p> <div class="el-image"><div class="el-image__placeholder"></div><!----></div> <p>③from ServiceWorker 只表示请求通过了 Service Worker，至于到底是命中了缓存，还是继续 fetch() 方法光看这一条记录其实无从知晓。因此还得配合后续的 Network 记录来看。因为之后没有额外的请求了，因此判定是命中了缓存。</p> <div class="el-image"><div class="el-image__placeholder"></div><!----></div> <p>从服务器的日志也能很明显地看到，3 个资源都没有被重新请求，即命中了 Service Worker 内部的缓存。</p> <p>如果修改 serviceWorker.js 的 fetch 事件监听代码，改为如下：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 这个也叫做 NetworkOnly 的缓存策略。</span>
self<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'fetch'</span><span class="token punctuation">,</span> <span class="token parameter">e</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> e<span class="token punctuation">.</span><span class="token function">respondWith</span><span class="token punctuation">(</span><span class="token function">fetch</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>request<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>可以发现在后续访问时的效果和修改前是 完全一致的。(即 Network 仅有标记为 from ServiceWorker 的几个请求，而服务器也不打印 3 个资源的访问日志)</p> <p>很明显 Service Worker 这层并没有去读取自己的缓存，而是直接使用 fetch() 进行请求。所以此时其实是 Cache-Control: max-age=86400 的设置起了作用，也就是 memory/disk cache。但具体是 memory 还是 disk 这个只有浏览器自己知道了，因为它并没有显式的告诉我们。</p> <h5 id="浏览器的行为"><a href="#浏览器的行为" class="header-anchor">#</a> 浏览器的行为</h5> <p>所谓浏览器的行为，指的就是用户在浏览器如何操作时，会触发怎样的缓存策略。主要有 3 种：</p> <ul><li>打开网页，地址栏输入地址： 查找 disk cache 中是否有匹配。如有则使用；如没有则发送网络请求。</li> <li>普通刷新 (F5)：因为 TAB 并没有关闭，因此 memory cache 是可用的，会被优先使用(如果匹配的话)。其次才是 disk cache。</li> <li>强制刷新 (Ctrl + F5)：浏览器不使用缓存，因此发送的请求头部均带有 Cache-control: no-cache(为了兼容，还带了 Pragma: no-cache)。服务器直接返回 200 和最新内容。</li></ul> <h5 id="缓存的应用模式"><a href="#缓存的应用模式" class="header-anchor">#</a> 缓存的应用模式</h5> <p>模式 1：不常变化的资源</p> <div class="language- extra-class"><pre class="language-text"><code>Cache-Control: max-age=31536000
</code></pre></div><p>通常在处理这类资源资源时，给它们的 Cache-Control 配置一个很大的 max-age=31536000 (一年)，这样浏览器之后请求相同的 URL 会命中强制缓存。而为了解决更新的问题，就需要在文件名(或者路径)中添加 hash， 版本号等动态字符，之后更改动态字符，达到更改引用 URL 的目的，从而让之前的强制缓存失效 (其实并未立即失效，只是不再使用了而已)。</p> <p>在线提供的类库 (如 jquery-3.3.1.min.js, lodash.min.js 等) 均采用这个模式。如果配置中还增加 public 的话，CDN 也可以缓存起来，效果拔群。</p> <p>这个模式的一个变体是在引用 URL 后面添加参数 (例如 ?v=xxx 或者 ?_=xxx)，这样就不必在文件名或者路径中包含动态参数，满足某些完美主义者的喜好。在项目每次构建时，更新额外的参数 (例如设置为构建时的当前时间)，则能保证每次构建后总能让浏览器请求最新的内容。</p> <blockquote><p>特别注意： 在处理 Service Worker 时，对待 sw-register.js(注册 Service Worker) 和 serviceWorker.js (Service Worker 本身) 需要格外的谨慎。如果这两个文件也使用这种模式，你必须多多考虑日后可能的更新及对策。</p></blockquote> <p>模式 2：经常变化的资源</p> <div class="language- extra-class"><pre class="language-text"><code>Cache-Control: no-cache
</code></pre></div><p>这里的资源不单单指静态资源，也可能是网页资源，例如博客文章。这类资源的特点是：URL 不能变化，但内容可以(且经常)变化。我们可以设置 Cache-Control: no-cache 来迫使浏览器每次请求都必须找服务器验证资源是否有效。</p> <p>既然提到了验证，就必须 ETag 或者 Last-Modified 出场。这些字段都会由专门处理静态资源的常用类库(例如 koa-static)自动添加，无需开发者过多关心。</p> <p>也正如上文中提到协商缓存那样，这种模式下，节省的并不是请求数，而是请求体的大小。所以它的优化效果不如模式 1 来的显著。</p> <p>模式 3：非常危险的模式 1 和 2 的结合 （反例）</p> <div class="language- extra-class"><pre class="language-text"><code>Cache-Control: max-age=600, must-revalidate
</code></pre></div><p>不知道是否有开发者从模式 1 和 2 获得一些启发：模式 2 中，设置了 no-cache，相当于 max-age=0, must-revalidate。我的应用时效性没有那么强，但又不想做过于长久的强制缓存，我能不能配置例如 max-age=600, must-revalidate 这样折中的设置呢？</p> <p>表面上看这很美好：资源可以缓存 10 分钟，10 分钟内读取缓存，10 分钟后和服务器进行一次验证，集两种模式之大成，但实际线上暗存风险。因为上面提过，浏览器的缓存有自动清理机制，开发者并不能控制。</p> <p>举个例子：当有 3 种资源： index.html, index.js, index.css。我们对这 3 者进行上述配置之后，假设在某次访问时，index.js 已经被缓存清理而不存在，但 index.html, index.css 仍然存在于缓存中。这时候浏览器会向服务器请求新的 index.js，然后配上老的 index.html, index.css 展现给用户。这其中的风险显而易见：不同版本的资源组合在一起，报错是极有可能的结局。</p> <p>除了自动清理引发问题，不同资源的请求时间不同也能导致问题。例如 A 页面请求的是 A.js 和 all.css，而 B 页面是 B.js 和 all.css。如果我们以 A -&gt; B 的顺序访问页面，势必导致 all.css 的缓存时间早于 B.js。那么以后访问 B 页面就同样存在资源版本失配的隐患。</p> <p>不使用must-revalidate，只是Cache-Control: max-age=600，浏览器缓存的自动清理机制就不会执行么？如果浏览器缓存的自动清理机制执行的话那后续的index.js被清掉的所引发的情况都是一样的呀！</p> <p>这个问题涉及几个小点，我补充说明一下：</p> <ul><li>‘max-age=600’ 和 ‘max-age=600,must-revalidate’ 有什么区别？</li></ul> <p>没有区别。在列出 max-age 了之后，must-revalidate 是否列出效果相同，浏览器都会在超过 max-age 之后进行校验，验证缓存是否可用。</p> <p>在 HTTP 的规范中，只阐述了 must-revalidate 的作用，却没有阐述不列出 must-revalidate 时，浏览器应该如何解决缓存过期的问题，因此这其实是浏览器实现时的自主决策。（可能有少数浏览器选择在源站点无法访问时继续使用过期缓存，但这取决于浏览器自身）</p> <ul><li>那 ‘max-age=600’ 是不是也会引发问题？</li></ul> <p>是的。问题的出现和是否列出 ‘must-revalidate’ 无关，依然会存在 JS CSS等文件版本失配的问题。因此常规的网站在不同页面需要使用不同的 JS CSS 文件时，如果要使用 max-age 做强缓存，不要设置一个太短的时间。</p> <ul><li>那这类比较短的 max-age 到底能用在哪里呢？</li></ul> <p>既然版本存在失配的问题，那么要避开这个问题，就有两种方法。</p> <p>整站都使用相同的 JS 和 CSS，即合并后的文件。这个比较适合小型站点，否则可能过于冗余，影响性能。（不过可能还是会因为浏览器自身的清理策略被清理，依然有隐患）
资源是独立使用的，并不需要和其他文件配合生效。例如 RSS 就归在此类。</p> <h4 id="使用-cdn"><a href="#使用-cdn" class="header-anchor">#</a> 使用 CDN</h4> <p>基本原理：CDN的全称是Content Delivery Network，即内容分发网络，选择一个最近的边缘节点获取所需的资源，如果没有就会往上寻找，直到源文件，最后缓存下来，其他用户就可以直接使用最近的边缘节点内容。</p> <h3 id="减少重排-回流-reflow"><a href="#减少重排-回流-reflow" class="header-anchor">#</a> 减少重排(回流)(Reflow)</h3> <p>基本原理：重排是 DOM 的变化影响到了元素的几何属性（宽和高），浏览器会重新计算元素的几何属性，会使渲染树中受到影响的部分失效，浏览器会验证 DOM 树上的所有其它结点的 visibility 属性，这也是 Reflow 低效的原因。如果 Reflow 的过于频繁，CPU 使用率就会急剧上升。</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>回流：当我们对 DOM 的修改引发了 DOM 几何尺寸的变化（比如修改元素的宽、高或隐藏元素等）时，浏览器需要重新计算元素的几何属性（其他元素的几何属性和位置也会因此受到影响），然后再将计算的结果绘制出来。这个过程就是回流（也叫重排）。
重绘：当我们对 DOM 的修改导致了样式的变化、却并未影响其几何属性（比如修改了颜色或背景色）时，浏览器不需重新计算元素的几何属性、直接为该元素绘制新的样式（跳过了上图所示的回流环节）。这个过程叫做重绘。
<strong>重绘不一定导致回流，回流一定会导致重绘。</strong></p></div> <div class="custom-block danger"><p class="custom-block-title">注意</p> <p>减少 Reflow，如果需要在 DOM 操作时添加样式，尽量使用 增加 class 属性，而不是通过 style 操作样式。</p></div> <div class="custom-block tip"><p class="custom-block-title">发生重绘回流</p> <ul><li>添加或删除可见的DOM元素</li> <li>元素的位置发生变化</li> <li>元素的尺寸发生变化（包括外边距、内边框、边框大小、高度和宽度等）</li> <li>内容发生变化，比如文本变化或图片被另一个不同尺寸的图片所替代。</li> <li>页面一开始渲染的时候（这肯定避免不了）</li> <li>浏览器的窗口尺寸变化（因为回流是根据视口的大小来计算元素的位置和大小的）</li></ul></div> <p>可以采取以下的方式：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//使用cssText</span>
<span class="token keyword">const</span> el <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'test'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
el<span class="token punctuation">.</span>style<span class="token punctuation">.</span>cssText <span class="token operator">+=</span> <span class="token string">'border-left: 1px; border-right: 2px; padding: 5px;'</span><span class="token punctuation">;</span>

<span class="token comment">//修改CSS的class</span>
<span class="token keyword">const</span> el <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'test'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
el<span class="token punctuation">.</span>className <span class="token operator">+=</span> <span class="token string">' active'</span><span class="token punctuation">;</span> 
</code></pre></div><h4 id="addeventlistener减少监听事件的绑定"><a href="#addeventlistener减少监听事件的绑定" class="header-anchor">#</a> addEventListener减少监听事件的绑定</h4> <h4 id="减少dom操作-合并操作"><a href="#减少dom操作-合并操作" class="header-anchor">#</a> 减少dom操作，合并操作</h4> <p><em><strong>DOM 是属于渲染引擎中的东西，而 JS 又是 JS 引擎中的东西。当我们通过 JS 操作 DOM 的时候，其实这个操作涉及到了两个线程之间的通信，那么势必会带来一些性能上的损耗。</strong></em> 操作 DOM 次数一多，也就等同于一直在进行线程之间的通信，并且操作 DOM 可能还会带来重绘回流的情况，所以也就导致了性能上的问题。</p> <p><em><strong>减少 DOM 操作的核心思路，就是让 JS 去给 DOM 分压。</strong></em></p> <p>JS 是很快的，在 JS 中修改 DOM 对象也是很快的。在JS的世界里，一切是简单的、迅速的。但 DOM 操作并非 JS 一个人的独舞，而是两个模块之间的协作。</p> <ul><li>使元素脱离文档流</li> <li>对其进行多次修改</li> <li>将元素带回到文档中。
该过程的第一步和第三步可能会引起回流，但是经过第一步之后，对DOM的所有修改都不会引起回流，因为它已经不在渲染树了。过“桥”要收费——这个开销本身就是不可忽略的。</li></ul> <div class="custom-block tip"><p class="custom-block-title">方式</p> <p>有三种方式可以让DOM脱离文档流：</p> <ul><li><strong>隐藏元素，应用修改，重新显示</strong></li> <li>使用文档片段(document fragment)在当前DOM之外构建一个子树，再把它拷贝回文档。</li> <li>将原始元素拷贝到一个脱离文档的节点中，修改节点后，再替换原始的元素。</li></ul></div> <p>考虑我们要执行一段批量插入节点的代码：</p> <p>隐藏元素，应用修改，重新显示
这个会在展示和隐藏节点的时候，产生两次重绘</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">appendDataToElement</span><span class="token punctuation">(</span><span class="token parameter">appendToElement<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> li<span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> data<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        li <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'li'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        li<span class="token punctuation">.</span>textContent <span class="token operator">=</span> <span class="token string">'text'</span><span class="token punctuation">;</span>
        appendToElement<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>li<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">const</span> ul <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'list'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
ul<span class="token punctuation">.</span>style<span class="token punctuation">.</span>display <span class="token operator">=</span> <span class="token string">'none'</span><span class="token punctuation">;</span>
<span class="token function">appendDataToElement</span><span class="token punctuation">(</span>ul<span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">;</span>
ul<span class="token punctuation">.</span>style<span class="token punctuation">.</span>display <span class="token operator">=</span> <span class="token string">'block'</span><span class="token punctuation">;</span>
</code></pre></div><p>使用文档片段(document fragment)在当前DOM之外构建一个子树，再把它拷贝回文档</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> ul <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'list'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> fragment <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createDocumentFragment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">appendDataToElement</span><span class="token punctuation">(</span>fragment<span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">;</span>
ul<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>fragment<span class="token punctuation">)</span><span class="token punctuation">;</span> 
</code></pre></div><blockquote><p>DocumentFragment 接口表示一个没有父级文件的最小文档对象。它被当做一个轻量版的 Document 使用，用于存储已排好版的或尚未打理好格式的XML片段。因为 DocumentFragment 不是真实 DOM 树的一部分，它的变化不会引起 DOM 树的重新渲染的操作（reflow），且不会导致性能等问题。</p></blockquote> <h3 id="避免触发同步布局事件"><a href="#避免触发同步布局事件" class="header-anchor">#</a> 避免触发同步布局事件</h3> <p>上文我们说过，当我们访问元素的一些属性的时候，会导致浏览器强制清空队列，进行强制同步布局。举个例子，比如说我们想将一个p标签数组的宽度赋值为一个元素的宽度，我们可能写出这样的代码：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">initP</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> paragraphs<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        paragraphs<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>style<span class="token punctuation">.</span>width <span class="token operator">=</span> box<span class="token punctuation">.</span>offsetWidth <span class="token operator">+</span> <span class="token string">'px'</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span> 
</code></pre></div><p>这段代码看上去是没有什么问题，可是其实会造成很大的性能问题。在每次循环的时候，都读取了box的一个offsetWidth属性值，然后利用它来更新p标签的width属性。这就导致了每一次循环的时候，浏览器都必须先使上一次循环中的样式更新操作生效，才能响应本次循环的样式读取操作。 <strong>每一次循环都会强制浏览器刷新队列</strong> 。我们可以优化为:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> width <span class="token operator">=</span> box<span class="token punctuation">.</span>offsetWidth<span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">initP</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> paragraphs<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        paragraphs<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>style<span class="token punctuation">.</span>width <span class="token operator">=</span> width <span class="token operator">+</span> <span class="token string">'px'</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="服务端渲染"><a href="#服务端渲染" class="header-anchor">#</a> 服务端渲染</h3> <p>服务端渲染的模式下，当用户第一次请求页面时，由服务器把需要的组件或页面渲染成 HTML 字符串，然后把它返回给客户端。客户端拿到手的，是可以直接渲染然后呈现给用户的 HTML 内容，不需要为了生成 DOM 内容自己再去跑一遍 JS 代码。</p> <h3 id="懒加载和预加载"><a href="#懒加载和预加载" class="header-anchor">#</a> 懒加载和预加载</h3> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">data-v-b2db8566</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token punctuation">&quot;</span></span> 
    <span class="token attr-name">data-v-009ea7bb</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token punctuation">&quot;</span></span> 
    <span class="token attr-name">data-v-6b46a625</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token punctuation">&quot;</span></span>   
    <span class="token attr-name">data-src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>https://user-gold-cdn.xitu.io/2018/9/27/16619f449ee24252?imageView2/1/w/120/h/120/q/85/format/webp/interlace/1<span class="token punctuation">&quot;</span></span>    
    <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>lazy thumb thumb<span class="token punctuation">&quot;</span></span>    
    <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token value css language-css"><span class="token property">background-image</span><span class="token punctuation">:</span> none<span class="token punctuation">;</span> <span class="token property">background-size</span><span class="token punctuation">:</span> cover<span class="token punctuation">;</span></span><span class="token punctuation">&quot;</span></span></span><span class="token punctuation">&gt;</span></span>  
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>背景图片设置为了 none。也就是说这个 div 是没有内容的，它只起到一个占位的作用,一旦通过滚动使得这个 div 出现在了可见范围内，那么 div 元素的内容就会发生变化，呈现如下的内容</p> <div class="language-css extra-class"><pre class="language-css"><code>style=<span class="token string">&quot;background-image: url(&amp;quot;https://user-gold-cdn.xitu.io/2018/9/27/16619f449ee24252?imageView2/1/w/120/h/120/q/85/format/webp/interlace/1&amp;quot;); background-size: cover;&quot;</span>
</code></pre></div><p>注意节流和抖动。</p> <h3 id="阻塞渲染"><a href="#阻塞渲染" class="header-anchor">#</a> 阻塞渲染</h3> <p>首先渲染的前提是生成渲染树，所以 HTML 和 CSS 肯定会阻塞渲染。如果你想渲染的越快，你越应该降低一开始需要渲染的文件大小，<code>并且扁平层级，优化选择器。</code></p> <p>然后当浏览器在解析到 script 标签时，会暂停构建 DOM，完成后才会从暂停的地方重新开始。也就是说，如果你想首屏渲染的越快，就越不应该在首屏就加载 JS 文件，这也是都建议将 script 标签放在 body 标签底部的原因。</p> <p>当然在当下，并不是说 script 标签必须放在底部，因为你可以给 script 标签添加 defer 或者 async 属性。</p> <p>当 script 标签加上 defer 属性以后，表示该 JS 文件会并行下载，但是会放到 HTML 解析完成后顺序执行，所以对于这种情况你可以把 script 标签放在任意位置。</p> <p>对于没有任何依赖的 JS 文件可以加上 async 属性，表示 JS 文件下载和解析不会阻塞渲染。</p> <h4 id="参考资料"><a href="#参考资料" class="header-anchor">#</a> 参考资料</h4> <p>浏览器在加载页面的时候会用到 GUI 渲染线程和 JavaScript 引擎线程。其中，GUI 渲染线程负责渲染浏览器界面 HTML 元素，JavaScript 引擎线程主要负责处理 JavaScript 脚本程序。</p> <p>由于 JavaScript 在执行过程中还可能会改动界面结构和样式，因此它们之间被设计为互斥的关系。也就是说，当 JavaScript 引擎执行时，GUI 线程会被挂起。</p> <p>以拉勾官网为例，我们来看看网页加载流程。</p> <ol><li>当我们打开拉勾官网的时候，浏览器会从服务器中获取到 HTML 内容。</li> <li>浏览器获取到 HTML 内容后，就开始从上到下解析 HTML 的元素。</li> <li><code>&lt;head&gt;</code>元素内容会先被解析，此时浏览器还没开始渲染页面。</li></ol> <div class="language- extra-class"><pre class="language-text"><code>我们看到&lt;head&gt;元素里有用于描述页面元数据的&lt;meta&gt;元素，还有一些&lt;link&gt;元素涉及外部资源（如图片、CSS 样式等），此时浏览器会去获取这些外部资源。
除此之外，我们还能看到&lt;head&gt;元素中还包含着不少的&lt;script&gt;元素，这些&lt;script&gt;元素通过src属性指向外部资源。
</code></pre></div><ol start="4"><li>当浏览器解析到这里时（步骤 3），会暂停解析并下载 JavaScript 脚本。</li> <li>当 JavaScript 脚本下载完成后，浏览器的控制权转交给 JavaScript 引擎。当脚本执行完成后，控制权会交回给渲染引擎，渲染引擎继续往下解析 HTML 页面。</li> <li>此时<code>&lt;body&gt;</code>元素内容开始被解析，浏览器开始渲染页面。</li></ol> <div class="language- extra-class"><pre class="language-text"><code>在这个过程中，我们看到&lt;head&gt;中放置的&lt;script&gt;元素会阻塞页面的渲染过程：把 JavaScript 放在&lt;head&gt;里，意味着必须把所有 JavaScript 代码都下载、解析和解释完成后，才能开始渲染页面。
到这里，我们就明白了：如果外部脚本加载时间很长（比如一直无法完成下载），就会造成网页长时间失去响应，浏览器就会呈现“假死”状态，用户体验会变得很糟糕。
因此，对于对性能要求较高、需要快速将内容呈现给用户的网页，常常会将 JavaScript 脚本放在&lt;body&gt;的最后面。这样可以避免资源阻塞，页面得以迅速展示。我们还可以使用defer/async/preload等属性来标记&lt;script&gt;标签，来控制 JavaScript 的加载顺序。
</code></pre></div><h3 id="优化隐藏类和删除操作"><a href="#优化隐藏类和删除操作" class="header-anchor">#</a> 优化隐藏类和删除操作</h3> <ul><li>V8引擎会添加隐藏类，但是如果动态添加新属性，本来可以共享的隐藏类就只能分开成多个了，且如果删除，也是同样的结果。</li> <li>最后不要动态添加属性，初始属性宁可undefined，同时如果某个属性不需要，置空即可</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">Article</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>title <span class="token operator">=</span> <span class="token string">'Inauguration Ceremony Features Kazoo Band'</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">let</span> a1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Article</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> a2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Article</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

a2<span class="token punctuation">.</span>author <span class="token operator">=</span> <span class="token string">'Jake'</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a1<span class="token punctuation">)</span><span class="token comment">//Article {title: 'Inauguration Ceremony Features Kazoo Band'}</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a2<span class="token punctuation">)</span><span class="token comment">//Article {title: 'Inauguration Ceremony Features Kazoo Band', author: 'Jake'}</span>


<span class="token keyword">function</span> <span class="token function">Article1</span><span class="token punctuation">(</span><span class="token parameter">opt_author</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>title <span class="token operator">=</span> <span class="token string">'Inauguration Ceremony Features Kazoo Band'</span><span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>author <span class="token operator">=</span> opt_author<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">let</span> a3 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Article1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> a4 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Article1</span><span class="token punctuation">(</span><span class="token string">'Jake'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a3<span class="token punctuation">)</span><span class="token comment">//Article1 {title: 'Inauguration Ceremony Features Kazoo Band', author: undefined}</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a4<span class="token punctuation">)</span><span class="token comment">//Article1 {title: 'Inauguration Ceremony Features Kazoo Band', author: 'Jake'}</span>


<span class="token keyword">function</span> <span class="token function">Article2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>title <span class="token operator">=</span> <span class="token string">'Inauguration Ceremony Features Kazoo Band'</span><span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>author <span class="token operator">=</span> <span class="token string">'Jake'</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">let</span> a5 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Article2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> a6 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Article2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">delete</span> a5<span class="token punctuation">.</span>author<span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a5<span class="token punctuation">)</span><span class="token comment">//Article2 {title: 'Inauguration Ceremony Features Kazoo Band'}</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a6<span class="token punctuation">)</span><span class="token comment">//Article2 {title: 'Inauguration Ceremony Features Kazoo Band', author: 'Jake'}</span>


<span class="token keyword">function</span> <span class="token function">Article3</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>title <span class="token operator">=</span> <span class="token string">'Inauguration Ceremony Features Kazoo Band'</span><span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>author <span class="token operator">=</span> <span class="token string">'Jake'</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">let</span> a7 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Article3</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> a8 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Article3</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
a8<span class="token punctuation">.</span>author <span class="token operator">=</span><span class="token keyword">null</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a7<span class="token punctuation">)</span><span class="token comment">//Article3 {title: 'Inauguration Ceremony Features Kazoo Band', author: 'Jake'}</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a8<span class="token punctuation">)</span><span class="token comment">//Article3 {title: 'Inauguration Ceremony Features Kazoo Band', author: null}</span>
</code></pre></div><h4 id="gzip压缩"><a href="#gzip压缩" class="header-anchor">#</a> gzip压缩</h4> <p>gzip 压缩效率非常高，通常可以达到 70% 的压缩率，也就是说，如果你的网页有 30K，压缩之后就变成了 9K 左右。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//npm i -D compression-webpack-plugin</span>
<span class="token function-variable function">configureWebpack</span><span class="token operator">:</span> <span class="token parameter">config</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> CompressionPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'compression-webpack-plugin'</span><span class="token punctuation">)</span>
  config<span class="token punctuation">.</span>plugins<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">CompressionPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="去除-console-log"><a href="#去除-console-log" class="header-anchor">#</a> 去除 console.log</h4> <p>线上项目自然不应该被看到控制台的打印日志,所以我们需要将 console.log 都去除掉。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//npm i -D terser-webpack-plugin </span>
 <span class="token function-variable function">configureWebpack</span><span class="token operator">:</span> <span class="token parameter">config</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
   <span class="token keyword">const</span> TerserPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'terser-webpack-plugin'</span><span class="token punctuation">)</span>
   config<span class="token punctuation">.</span>optimization<span class="token punctuation">.</span>minimizer<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>
     <span class="token keyword">new</span> <span class="token class-name">TerserPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
       <span class="token literal-property property">extractComments</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
       <span class="token literal-property property">terserOptions</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">compress</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">drop_console</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
     <span class="token punctuation">}</span><span class="token punctuation">)</span>
   <span class="token punctuation">)</span>
 <span class="token punctuation">}</span>
</code></pre></div><h4 id="去除-sourcemap"><a href="#去除-sourcemap" class="header-anchor">#</a> 去除 SourceMap</h4> <p>由于打包后的文件经过了压缩、合并、混淆、babel编译后的代码不利于定位分析bug。</p> <div class="language-js extra-class"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">productionSourceMap</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="静态分配与对象池"><a href="#静态分配与对象池" class="header-anchor">#</a> 静态分配与对象池 ？？</h3> <h3 id="代码解耦"><a href="#代码解耦" class="header-anchor">#</a> 代码解耦</h3> <ul><li>解耦HTML/JS</li> <li>CSS/JS(js尽量不直接改css样式，利用添加移除类修改)</li> <li>function一个功能一个function，不要写在一起杂糅，传参也要尽量少</li> <li>常量定义</li> <li>全局变量少用，尽量包裹起来</li> <li>多次使用到的方法，提取，来减少复杂度-</li> <li>优化循环，减小循环体</li> <li>循环次数少且已知，可展开循环，多次请求；这样可以节省创建循环，计算终止条件的消耗。</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// eliminated the loop</span>
<span class="token function">process</span><span class="token punctuation">(</span>values<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">process</span><span class="token punctuation">(</span>values<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">process</span><span class="token punctuation">(</span>values<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ul><li>switch快于if。。。else</li> <li>语句最少化，能合并的不要分开写</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> name <span class="token operator">=</span> values<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
i<span class="token operator">++</span><span class="token punctuation">;</span>
<span class="token comment">//====&gt;let name = values[i++];一句代码解决</span>
</code></pre></div><ul><li>达夫设备优化</li></ul> <div class="language-js extra-class"><pre class="language-js"><code>	<span class="token comment">// credit: Jeff Greenberg for JS implementation of Duff's Device</span>
	<span class="token comment">// assumes values.length &gt; 0</span>
	<span class="token keyword">let</span> values<span class="token operator">=</span><span class="token punctuation">{</span>
		<span class="token literal-property property">length</span><span class="token operator">:</span><span class="token number">81</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">let</span> iterations <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">ceil</span><span class="token punctuation">(</span>values<span class="token punctuation">.</span>length <span class="token operator">/</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">let</span> startAt <span class="token operator">=</span> values<span class="token punctuation">.</span>length <span class="token operator">%</span> <span class="token number">8</span><span class="token punctuation">;</span>
	<span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
	           
	<span class="token keyword">do</span> <span class="token punctuation">{</span>
	  <span class="token keyword">switch</span><span class="token punctuation">(</span>startAt<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	    <span class="token keyword">case</span> <span class="token number">0</span><span class="token operator">:</span> <span class="token function">process</span><span class="token punctuation">(</span>values<span class="token punctuation">[</span>i<span class="token operator">++</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	    <span class="token keyword">case</span> <span class="token number">7</span><span class="token operator">:</span> <span class="token function">process</span><span class="token punctuation">(</span>values<span class="token punctuation">[</span>i<span class="token operator">++</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	    <span class="token keyword">case</span> <span class="token number">6</span><span class="token operator">:</span> <span class="token function">process</span><span class="token punctuation">(</span>values<span class="token punctuation">[</span>i<span class="token operator">++</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	    <span class="token keyword">case</span> <span class="token number">5</span><span class="token operator">:</span> <span class="token function">process</span><span class="token punctuation">(</span>values<span class="token punctuation">[</span>i<span class="token operator">++</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	    <span class="token keyword">case</span> <span class="token number">4</span><span class="token operator">:</span> <span class="token function">process</span><span class="token punctuation">(</span>values<span class="token punctuation">[</span>i<span class="token operator">++</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	    <span class="token keyword">case</span> <span class="token number">3</span><span class="token operator">:</span> <span class="token function">process</span><span class="token punctuation">(</span>values<span class="token punctuation">[</span>i<span class="token operator">++</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	    <span class="token keyword">case</span> <span class="token number">2</span><span class="token operator">:</span> <span class="token function">process</span><span class="token punctuation">(</span>values<span class="token punctuation">[</span>i<span class="token operator">++</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	    <span class="token keyword">case</span> <span class="token number">1</span><span class="token operator">:</span> <span class="token function">process</span><span class="token punctuation">(</span>values<span class="token punctuation">[</span>i<span class="token operator">++</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	  <span class="token punctuation">}</span>
	  startAt <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span> <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token operator">--</span>iterations <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	
	<span class="token keyword">function</span> <span class="token function">process</span><span class="token punctuation">(</span><span class="token parameter">v<span class="token punctuation">,</span>v1</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
		console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>v<span class="token punctuation">,</span>v1<span class="token punctuation">,</span>startAt<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
</code></pre></div><p>前端优化大概可以有以下几个方向：</p> <p>网络优化
页面渲染优化
JS优化
图片优化
webpack打包优化
React优化
Vue优化</p> <p>网络优化
DNS预解析
link标签的rel属性设置dns-prefetch，提前获取域名对应的IP地址
使用缓存
减轻服务端压力，快速得到数据(强缓存和协商缓存可以看这里)
使用 CDN（内容分发网络）
用户与服务器的物理距离对响应时间也有影响。
内容分发网络（CDN）是一组分散在不同地理位置的 web 服务器，用来给用户更高效地发送内容。典型地，选择用来发送内容的服务器是基于网络距离的衡量标准的。例如：选跳数（hop）最少的或者响应时间最快的服务器。
压缩响应
压缩组件通过减少 HTTP 请求产生的响应包的大小，从而降低传输时间的方式来提高性能。从 HTTP1.1 开始，Web 客户端可以通过 HTTP 请求中的 Accept-Encoding 头来标识对压缩的支持（这个请求头会列出一系列的压缩方法）
如果 Web 服务器看到请求中的这个头，就会使用客户端列出的方法中的一种来压缩响应。Web 服务器通过响应中的 Content-Encoding 头来告知 Web 客户端使用哪种方法进行的压缩
目前许多网站通常会压缩 HTML 文档，脚本和样式表的压缩也是值得的（包括 XML 和 JSON 在内的任何文本响应理论上都值得被压缩）。但是，图片和 PDF 文件不应该被压缩，因为它们本来已经被压缩了。
使用多个域名
Chrome 等现代化浏览器，都会有同域名限制并发下载数的情况，不同的浏览器及版本都不一样，使用不同的域名可以最大化下载线程，但注意保持在 2~4 个域名内，以避免 DNS 查询损耗。
避免图片src为空
虽然 src 属性为空字符串，但浏览器仍然会向服务器发起一个 HTTP 请求：
IE 向页面所在的目录发送请求；
Safari、Chrome、Firefox 向页面本身发送请求；
Opera 不执行任何操作。
页面渲染优化
Webkit 渲染引擎流程：</p> <p>处理 HTML 并构建 DOM 树
处理 CSS 构建 CSS 规则树(CSSOM)
DOM Tree 和 CSSOM Tree 合成一棵渲染树 Render Tree。
根据渲染树来布局，计算每个节点的位置
调用 GPU 绘制，合成图层，显示在屏幕上</p> <p>避免css阻塞
css影响renderTree的构建，会阻塞页面的渲染，因此应该尽早（将 CSS 放在 head 标签里）和尽快（启用 CDN 实现静态资源加载速度的优化)的将css资源加载
降低css选择器的复杂度
浏览器读取选择器，遵循的原则是从选择器的右边到左边读取。</p> <p>减少嵌套：最多不要超过三层，并且后代选择器的开销较高，慎重使用
避免使用通配符，对用到的元素进行匹配即可
利用继承，避免重复匹配和定义
正确使用类选择器和id选择器</p> <p>避免使用CSS 表达式
css 表达式会被频繁地计算。
避免js阻塞
js可以修改CSSOM和DOM，因此js会阻塞页面的解析和渲染，并且会等待css资源的加载。也就是说js会抢走渲染引擎的控制权。所以我们需要给js资源添加defer或者async，延迟js脚本的执行。
使用外链式的js和css
在现实环境中使用外部文件通常会产生较快的页面，因为 JavaScript 和 CSS 有机会被浏览器缓存起来。对于内联的情况，由于 HTML 文档通常不会被配置为可以进行缓存的，所以每次请求 HTML 文档都要下载 JavaScript 和 CSS。所以，如果 JavaScript 和 CSS 在外部文件中，浏览器可以缓存它们，HTML 文档的大小会被减少而不必增加 HTTP 请求数量。
使用字体图标 iconfont 代替图片图标</p> <p>图片会增加网络请求次数，从而拖慢页面加载时间
iconfont可以很好的缩放并且不会添加额外的请求</p> <p>首屏加载优化</p> <p>使用骨架屏或者动画优化用户体验
资源按需加载，首页不需要的资源延迟加载</p> <p>减少重绘和回流</p> <p>增加多个节点使用documentFragment：不是真实dom的部分，不会引起重绘和回流</p> <p>用 translate 代替 top ，因为 top 会触发回流，但是translate不会。所以translate会比top节省了一个layout的时间</p> <p>使用 visibility 替换 display: none ，因为前者只会引起重绘，后者会引发回流（改变了布局）；opacity 代替 visiability，visiability会触发重绘（paint），但opacity不会。</p> <p>把 DOM 离线后修改，比如：先把 DOM 给 display:none (有一次 Reflow)，然后你修改 100 次，然后再把它显示出来</p> <p>不要把 DOM 结点的属性值放在一个循环里当成循环里的变量
for (let i = 0; i &lt; 1000; i++) {
// 获取 offsetTop 会导致回流，因为需要去获取正确的值
console.log(document.querySelector('.test').style.offsetTop)
}
复制代码</p> <p>尽量少用table布局，table布局的话，每次有单元格布局改变，都会进行整个tabel回流重绘；</p> <p>最好别频繁去操作DOM节点，最好把需要操作的样式，提前写成class，之后需要修改。只需要修改一次，需要修改的时候，直接修改className，做成一次性更新多条css DOM属性，一次回流重绘总比多次回流重绘要付出的成本低得多；</p> <p>动画实现的速度的选择，动画速度越快，回流次数越多，也可以选择使用 requestAnimationFrame</p> <p>每次访问DOM的偏移量属性的时候，例如获取一个元素的scrollTop、scrollLeft、scrollWidth、offsetTop、offsetLeft、offsetWidth、offsetHeight之类的属性，浏览器为了保证值的正确也会回流取得最新的值，所以如果你要多次操作，最取完做个缓存。更加不要for循环中访问DOM偏移量属性，而且使用的时候，最好定义一个变量，把要需要的值赋值进去，进行值缓存，把回流重绘的次数减少；</p> <p>将频繁运行的动画变为图层，图层能够阻止该节点回流影响别的元素。比如对于 video 标签，浏览器会自动将该节点变为图层。</p> <p>JS中的性能优化
使用事件委托
防抖和节流
尽量不要使用JS动画
css3动画和canvas动画都比JS动画性能好
多线程
复杂的计算开启webWorker进行计算，避免页面假死
计算结果缓存
减少运算次数，比如vue中的computed
图片的优化
雪碧图
借助减少http请求次数来进行优化
图片懒加载
在图片即将进入可视区域的时候进行加载（判断图片进入可视区域请参考这里）
使用CSS3代替图片
有很多图片使用 CSS 效果（渐变、阴影等）就能画出来，这种情况选择 CSS3 效果更好
图片压缩
压缩方法有两种，一是通过在线网站进行压缩，二是通过 webpack 插件 image-webpack-loader。它是基于 imagemin 这个 Node 库来实现图片压缩的。
使用渐进式jpeg
使用渐进式jpeg，会提高用户体验 参考文章
使用 webp 格式的图片
webp 是一种新的图片文件格式，它提供了有损压缩和无损压缩两种方式。在相同图片质量下，webp 的体积比 png 和 jpg 更小。
webpack打包优化
缩小loader 匹配范围</p> <p>优化loader配置
test、include、exclude三个配置项来缩⼩loader的处理范围
推荐include</p> <p>include: path.resolve(__dirname, &quot;./src&quot;),
复制代码
resolve.modules
resolve.modules用于配置webpack去哪些目录下寻找第三方模块，默认是 node_modules。
寻找第三方，默认是在当前项目目录下的node_modules里面去找，如果没有找到，就会去上一级目录../node_modules找，再没有会去../../node_modules中找，以此类推，和Node.js的模块寻找机制很类似。
如果我们的第三⽅模块都安装在了项⽬根⽬录下，就可以直接指明这个路径。
module.exports={
resolve:{
modules: [path.resolve(__dirname, &quot;./node_modules&quot;)]
}
}</p> <p>复制代码
resolve.extensions
resolve.extensions在导⼊语句没带⽂件后缀时，webpack会⾃动带上后缀后，去尝试查找⽂件是否存在。</p> <p>后缀尝试列表尽量的⼩
导⼊语句尽量的带上后缀。</p> <p>如果想优化到极致的话，不建议用extensionx, 因为它会消耗一些性能。虽然它可以带来一些便利。
抽离css
借助mini-css-extract-plugin:本插件会将 CSS 提取到单独的文件中，为每个包含 CSS 的 JS 文件创建一个 CSS 文件，并且支持 CSS 和 SourceMaps 的按需加载。。
const MiniCssExtractPlugin = require(&quot;mini-css-extract-plugin&quot;);
{
test: /.less$/,
use: [
// &quot;style-loader&quot;, // 不再需要style-loader，⽤MiniCssExtractPlugin.loader代替
MiniCssExtractPlugin.loader,
&quot;css-loader&quot;, // 编译css
&quot;postcss-loader&quot;,
&quot;less-loader&quot; // 编译less
]
},
plugins: [
new MiniCssExtractPlugin({
filename: &quot;css/[name]<em>[contenthash:6].css&quot;,
chunkFilename: &quot;[id].css&quot;
})
]
复制代码
代码压缩
JS代码压缩
mode:production，使用的是terser-webpack-plugin
module.exports = {
   // ...
   optimization: {
       minimize: true,
       minimizer: [
           new TerserPlugin({}),
       ]
   }
}
复制代码
CSS代码压缩
css-minimizer-webpack-plugin
module.exports = {
   // ...
   optimization: {
       minimize: true,
       minimizer: [
           new CssMinimizerPlugin({})
       ]
   }
}
复制代码
Html文件代码压缩
module.exports = {
   ...
   plugin:[
       new HtmlwebpackPlugin({
           ...
           minify:{
               minifyCSS:false, // 是否压缩css
               collapseWhitespace:false, // 是否折叠空格
               removeComments:true // 是否移除注释
           }
       })
   ]
}
复制代码
设置了minify，实际会使用另一个插件html-minifier-terser
文件大小压缩
对文件的大小进行压缩，减少http传输过程中宽带的损耗
npm install compression-webpack-plugin -D
复制代码
new ComepressionPlugin({
   test:/.(css|js)$/,  // 哪些文件需要压缩
   threshold:500, // 设置文件多大开始压缩
   minRatio:0.7, // 至少压缩的比例
   algorithm:&quot;gzip&quot;, // 采用的压缩算法
})
复制代码
图片压缩
一般来说在打包之后，一些图片文件的大小是远远要比 js 或者 css 文件要来的大，所以图片压缩较为重要
配置方法如下：
module: {
 rules: [
   {
     test: /.(png|jpg|gif)$/,
     use: [
       {
         loader: 'file-loader',
         options: {
           name: '[name]</em>[hash].[ext]',
           outputPath: 'images/',
         }
       },
       {
         loader: 'image-webpack-loader',
         options: {
           // 压缩 jpeg 的配置
           mozjpeg: {
             progressive: true,
             quality: 65
           },
           // 使用 imagemin**-optipng 压缩 png，enable: false 为关闭
           optipng: {
             enabled: false,
           },
           // 使用 imagemin-pngquant 压缩 png
           pngquant: {
             quality: '65-90',
             speed: 4
           },
           // 压缩 gif 的配置
           gifsicle: {
             interlaced: false,
           },
           // 开启 webp，会把 jpg 和 png 图片压缩为 webp 格式
           webp: {
             quality: 75
           }
         }
       }
     ]
   },
]
}
复制代码
Tree shaking 去除死代码
Tree Shaking 是一个术语，在计算机中表示消除死代码，依赖于ES Module的静态语法分析（不执行任何的代码，可以明确知道模块的依赖关系）
在webpack实现Tree shaking有两种不同的方案：</p> <p>usedExports：通过标记某些函数是否被使用，之后通过Terser来进行优化的
sideEffects：跳过整个模块/文件，直接查看该文件是否有副作用</p> <p>两种不同的配置方案， 有不同的效果
usedExports
配置方法也很简单，只需要将usedExports设为true
module.exports = {
   ...
   optimization:{
       usedExports
   }
}
复制代码
使用之后，没被用上的代码在webpack打包中会加入unused harmony export mul注释，用来告知 Terser 在优化时，可以删除掉这段代码
sideEffects
sideEffects用于告知webpack compiler哪些模块时有副作用，配置方法是在package.json中设置sideEffects属性
如果sideEffects设置为false，就是告知webpack可以安全的删除未用到的exports
如果有些文件需要保留，可以设置为数组的形式
&quot;sideEffecis&quot;:[
   &quot;./src/util/format.js&quot;,
   &quot;*.css&quot; // 所有的css文件
]
复制代码
上述都是关于javascript的tree shaking，css同样也能够实现tree shaking
css tree shaking
css进行tree shaking优化可以安装PurgeCss插件
npm install purgecss-plugin-webpack -D
复制代码
const PurgeCssPlugin = require('purgecss-webpack-plugin')
module.exports = {
   ...
   plugins:[
       new PurgeCssPlugin({
           path:glob.sync(<code>${path.resolve('./src')}/**/*</code>), {nodir:true}// src里面的所有文件
           satelist:function(){
               return {
                   standard:[&quot;html&quot;]
               }
           }
       })
   ]
}
复制代码</p> <p>paths：表示要检测哪些目录下的内容需要被分析，配合使用glob
默认情况下，Purgecss会将我们的html标签的样式移除掉，如果我们希望保留，可以添加一个safelist的属性</p> <p>babel-plugin-transform-runtime减少ES6转化ES5的冗余
Babel 插件会在将 ES6 代码转换成 ES5 代码时会注入一些辅助函数。在默认情况下， Babel 会在每个输出文件中内嵌这些依赖的辅助函数代码，如果多个源代码文件都依赖这些辅助函数，那么这些辅助函数的代码将会出现很多次，造成代码冗余。为了不让这些辅助函数的代码重复出现，可以在依赖它们时通过 require('babel-runtime/helpers/createClass') 的方式导入，这样就能做到只让它们出现一次。babel-plugin-transform-runtime 插件就是用来实现这个作用的，将相关辅助函数进行替换成导入语句，从而减小 babel 编译出来的代码的文件大小。
代码分离
将代码分离到不同的bundle中，之后我们可以按需加载，或者并行加载这些文件
默认情况下，所有的JavaScript代码（业务代码、第三方依赖、暂时没有用到的模块）在首页全部都加载，就会影响首页的加载速度
代码分离可以分出更小的bundle，以及控制资源加载优先级，提供代码的加载性能
这里通过splitChunksPlugin来实现，该插件webpack已经默认安装和集成，只需要配置即可
默认配置中，chunks仅仅针对于异步（async）请求，我们可以设置为initial或者all
module.exports = {
   ...
   optimization:{
       splitChunks:{
           chunks:&quot;all&quot;
       }
   }
}
复制代码
splitChunks主要属性有如下：</p> <p>Chunks，对同步代码还是异步代码进行处理
minSize： 拆分包的大小, 至少为minSize，如何包的大小不超过minSize，这个包不会拆分
maxSize： 将大于maxSize的包，拆分为不小于minSize的包
minChunks：被引入的次数，默认是1</p> <p>多线程打包提升打包速度
vue</p> <p>v-for添加key
路由懒加载
第三方插件按需引入
合理使用computed和watch
v-for的同时避免使用v-if
destory时销毁事件：比如addEventListener添加的事件、setTimeout、setInterval、bus.$on绑定的监听事件等</p> <p>react</p> <p>map循环展示添加key</p> <p>路由懒加载</p> <p>第三方插件按需引入</p> <p>使用scu，memo或者pureComponent避免不必要的渲染</p> <p>合理使用useMemo、memo、useCallback
他们三个的应用场景都是缓存结果，当依赖值没有改变时避免不必要的计算或者渲染。</p> <p>useCallback 是针对函数进行“记忆”的，当它依赖项没有发生改变时，那么该函数的引用并不会随着组件的刷新而被重新赋值。当我们觉得一个函数不需要随着组件的更新而更新引用地址的时候，我们就可以使用 useCallback 去修饰它。
React.memo 是对组件进行 “记忆”，当它接收的 props 没有发生改变的时候，那么它将返回上次渲染的结果，不会重新执行函数返回新的渲染结果。
React.useMemo是针对 值计算 的一种“记忆“，当依赖项没有发生改变时，那么无需再去计算，直接使用之前的值，对于组件而言，这带来的一个好处就是，可以减少一些计算，避免一些多余的渲染。当我们遇到一些数据需要在组件内部进行计算的时候，可以考虑一下 React.useMemo</p> <p>作者：let_code
链接：https://juejin.cn/post/7194400984490049573
来源：稀土掘金
著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。</p> <h4 id="参考文献"><a href="#参考文献" class="header-anchor">#</a> 参考文献</h4> <ul><li><a href="https://segmentfault.com/a/1190000017329980?utm_source=tag-newest" target="_blank" rel="noopener noreferrer">参考文献1<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="http://note.youdao.com/noteshare?id=beba0fb768f8d925aee874b647696f14&amp;sub=A597CE096A754AF7BA18133EE8DFE0D5" target="_blank" rel="noopener noreferrer">参考文献2<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://blog.csdn.net/sshuai131400/article/details/120939205" target="_blank" rel="noopener noreferrer">参考文献3<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <!----></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">最后更新:</span> <span class="time">2/7/2024, 4:39:07 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/basic/013typeof.html" class="prev">
         判断数据类型
      </a></span> <span class="next"><a href="/basic/014optimization1.html">
        前端性能优化2
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.a6ef9eb3.js" defer></script><script src="/assets/js/2.f1eac84e.js" defer></script><script src="/assets/js/1.51fb246a.js" defer></script><script src="/assets/js/84.a82c0122.js" defer></script><script src="/assets/js/25.8d300037.js" defer></script><script src="/assets/js/24.581980f2.js" defer></script>
  </body>
</html>
